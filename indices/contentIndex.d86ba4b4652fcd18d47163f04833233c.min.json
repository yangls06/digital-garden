{"/":{"title":"ğŸª´ æ— äººä¹‹è·¯.","content":"\n\næ¬¢è¿æ¥åˆ°â€œæ— äººä¹‹è·¯â€ï¼Œèµ°è¿›æˆ‘çš„æ•°å­—èŠ±å›­ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘æ±‡é›†ã€æ•´ç†è‡ªå·±åœ¨æ•°æ®ç³»ç»Ÿã€è‡ªåŠ¨é©¾é©¶ã€ä¸ªäººç®¡ç†ã€äººç”Ÿä½“æ‚Ÿç­‰æ–¹é¢çš„æ¶‰çŒå’Œæ€è€ƒï¼Œæ„å»ºè‡ªå·±çš„çŸ¥è¯†ç³»ç»Ÿå’Œç²¾ç¥ä¸–ç•Œã€‚\n\n\n\nä¸ªäººçš„è§’è‰²æ˜¯å¤šé‡çš„ï¼Œå¯¹åº”çš„ç²¾ç¥ä¸–ç•Œåº”è¯¥æ˜¯ä¸°å¯Œçš„ã€‚æˆ‘æœ‰ä¸‹é¢çš„å„ç§èº«ä»½ï¼š\n\n* é•¿æœŸæ¥çœ‹ï¼Œæˆ‘æ˜¯ä¸€ä¸ªæ•°æ®å·¥ç¨‹å¸ˆï¼Œè‡´åŠ›äºæ„å»ºæ•°æ®ç³»ç»Ÿï¼Œä»¥è¾…åŠ©æ•°æ®åŒ–å†³ç­–å’ŒAIç³»ç»Ÿã€‚\n* çŸ­æœŸæ¥çœ‹ï¼Œæˆ‘åœ¨è‡ªåŠ¨é©¾é©¶è¡Œä¸šå·¥ä½œï¼Œå¸®åŠ©è‡ªåŠ¨é©¾é©¶å›¢é˜Ÿæ„å»ºä»æ•°æ®é‡‡é›†ã€æ•°æ®ä¼ è¾“ã€æ•°æ®å­˜å‚¨ã€æ•°æ®æŒ–æ˜ã€æ•°æ®æ ‡æ³¨åˆ°æ•°æ®æ¶ˆè´¹çš„data pipelineï¼Œä»¥å®ç°æ•°æ®é—­ç¯ï¼ŒåŠ©åŠ›è‡ªåŠ¨é©¾é©¶çš„ç ”å‘ã€‚\n* ç»ˆèº«æ¥çœ‹ï¼Œæˆ‘æ˜¯ä¸€ä¸ªä¸ˆå¤«ã€çˆ¶äº²å’Œå„¿å­ï¼Œæƒ³è¦ç»è¥ä¸€ä¸ªå’Œè°ã€è¿›å–çš„å®¶åº­ï¼›å…¶åŸºçŸ³æ˜¯ï¼šæˆ‘æ˜¯ä¸€ä¸ªåœ¨æ€æƒ³ä¸Šä¸æ–­æ‹“å±•ã€è¿½æ±‚è‡ªç”±çš„ä¸ªäººã€‚\n\n\n\næ— è®ºä¸Šé¢çš„å“ªä¸€æ–¹é¢ï¼Œæƒ³è¦åšå¥½ï¼Œéƒ½è¦ä»˜å‡ºæŒç»­çš„åŠªåŠ›ï¼Œèµ°ä¸Šä¸æ–­ç§¯ç´¯ã€ä¸æ–­ç²¾è¿›çš„é“è·¯ã€‚æˆ‘æœŸå¾…åœ¨è¿™ä¸ªå°å°çš„æ•°å­—èŠ±å›­é‡Œï¼Œç¿»åœŸã€æ’­ç§ã€æµ‡æ°´ã€ä¿®å»ºã€æ–½è‚¥ã€æˆç²‰ï¼Œæ‰“ç†å‡ºå±äºè‡ªå·±çš„ä¸€ç‰‡ä¸–ç•Œã€‚\n\n\n\nMy Digital Garden include: \n\n* [Python Programming](notes/python-programming.md)\n* [Data System](notes/data-system.md)\n* [DevOps](notes/devops.md)\n\n","lastmodified":"2022-12-14T10:05:00.50340721Z","tags":null},"/notes/data-system":{"title":"Data System","content":"\n\n\n# Data System\n\n## Data Exploring \u0026 Visualization\n\n* [Hands on Zeppelin](notes/hands-on-zeppelin.md)","lastmodified":"2022-12-14T10:05:00.50340721Z","tags":null},"/notes/devops":{"title":"Data System","content":"\n# DevOps\n\n## Docker\n\n* [Dockerå…¥é—¨ï¼šstep by step](notes/hands-on-docker_1.md)\n* [Dockerè¿›é˜¶ï¼šstep by step](notes/hands-on-docker_2.md)","lastmodified":"2022-12-14T10:05:00.50340721Z","tags":null},"/notes/hands-on-docker_1":{"title":"Dockerå…¥é—¨æ•™ç¨‹","content":"\n\n\n# Dockerå…¥é—¨ï¼šstep by step\n\n\u003e ä¸ºä¸Šæ‰‹å­¦ä¹ Dockerï¼Œæˆ‘å‚ç…§é˜®ä¸€å³°è€å¸ˆå†™çš„æ•™ç¨‹ï¼Œstep by stepåœ°åŠ¨æ‰‹å®è·µã€‚æ­¤æ–‡è®°å½•ã€‚\n\n## å‚è€ƒ\n\n[é˜®ä¸€å³°ï¼šDockerå…¥é—¨æ•™ç¨‹](https://www.ruanyifeng.com/blog/2018/02/docker-tutorial.html)\n\n\n\n## ä¸€ã€ç¯å¢ƒé…ç½®çš„éš¾é¢˜\n\nè½¯ä»¶å¼€å‘æœ€å¤§çš„éº»çƒ¦ä¹‹ä¸€å°±æ˜¯ç¯å¢ƒé…ç½®ã€‚æ¯ä¸ªäººçš„æœºå™¨çš„ç³»ç»Ÿé…ç½®éƒ½ä¸ä¸€æ ·ï¼ŒåŒ…æ‹¬æ“ä½œç³»ç»Ÿã€å„ç§åº“ä¸ç»„ä»¶ã€ç¯å¢ƒå˜é‡ç­‰ç­‰ã€‚è½¯ä»¶+è¿è¡Œç¯å¢ƒï¼Œæ•´ä½“å‘å¸ƒæ˜¯è§£å†³è¿™ä¸ªé—®é¢˜çš„æ€è·¯ã€‚Dockekæ˜¯è¿™ç§æ€è·¯çš„å®ç°ã€‚\n\n## äºŒã€è™šæ‹Ÿæœº\n\nåœ¨Dockerä¹‹å‰ï¼Œè™šæ‹Ÿæœºæ˜¯ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚ä½†å…¶ç¼ºç‚¹æ˜æ˜¾ï¼ŒåŒ…æ‹¬ï¼š\n\n- **èµ„æºå ç”¨å¤š**ã€‚è™šæ‹Ÿæœºä¼šç‹¬å ä¸€éƒ¨åˆ†å†…å­˜å’Œç¡¬ç›˜ç©ºé—´ã€‚å®ƒè¿è¡Œçš„æ—¶å€™ï¼Œå…¶ä»–ç¨‹åºå°±ä¸èƒ½ä½¿ç”¨è¿™äº›èµ„æºäº†ã€‚å“ªæ€•è™šæ‹Ÿæœºé‡Œé¢çš„åº”ç”¨ç¨‹åºï¼ŒçœŸæ­£ä½¿ç”¨çš„å†…å­˜åªæœ‰ 1MBï¼Œè™šæ‹Ÿæœºä¾ç„¶éœ€è¦å‡ ç™¾ MB çš„å†…å­˜æ‰èƒ½è¿è¡Œã€‚\n\n- **å†—ä½™æ­¥éª¤å¤š**ã€‚è™šæ‹Ÿæœºæ˜¯å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œä¸€äº›ç³»ç»Ÿçº§åˆ«çš„æ“ä½œæ­¥éª¤ï¼Œå¾€å¾€æ— æ³•è·³è¿‡ï¼Œæ¯”å¦‚ç”¨æˆ·ç™»å½•ã€‚\n\n- **å¯åŠ¨æ…¢ã€‚**å¯åŠ¨æ“ä½œç³»ç»Ÿéœ€è¦å¤šä¹…ï¼Œå¯åŠ¨è™šæ‹Ÿæœºå°±éœ€è¦å¤šä¹…ã€‚å¯èƒ½è¦ç­‰å‡ åˆ†é’Ÿï¼Œåº”ç”¨ç¨‹åºæ‰èƒ½çœŸæ­£è¿è¡Œã€‚\n\n## ä¸‰ã€Linuxå®¹å™¨\n\nLinuxå®¹å™¨ï¼ˆLinux Containerï¼Œ LXCï¼‰æ˜¯å¦ä¸€ç§è™šæ‹ŸåŒ–æŠ€æœ¯ã€‚\n\n**Linux å®¹å™¨ä¸æ˜¯æ¨¡æ‹Ÿä¸€ä¸ªå®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œè€Œæ˜¯å¯¹è¿›ç¨‹è¿›è¡Œéš”ç¦»ã€‚**æˆ–è€…è¯´ï¼Œåœ¨æ­£å¸¸è¿›ç¨‹çš„å¤–é¢å¥—äº†ä¸€ä¸ª[ä¿æŠ¤å±‚](https://opensource.com/article/18/1/history-low-level-container-runtimes)ã€‚å¯¹äºå®¹å™¨é‡Œé¢çš„è¿›ç¨‹æ¥è¯´ï¼Œå®ƒæ¥è§¦åˆ°çš„å„ç§èµ„æºéƒ½æ˜¯è™šæ‹Ÿçš„ï¼Œä»è€Œå®ç°ä¸åº•å±‚ç³»ç»Ÿçš„éš”ç¦»ã€‚\n\nç”±äºå®¹å™¨æ˜¯è¿›ç¨‹çº§åˆ«çš„ï¼Œç›¸æ¯”è™šæ‹Ÿæœºæœ‰å¾ˆå¤šä¼˜åŠ¿ã€‚\n\n- **å¯åŠ¨å¿«ã€‚**å®¹å™¨é‡Œé¢çš„åº”ç”¨ï¼Œç›´æ¥å°±æ˜¯åº•å±‚ç³»ç»Ÿçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œä¸æ˜¯è™šæ‹Ÿæœºå†…éƒ¨çš„è¿›ç¨‹ã€‚æ‰€ä»¥ï¼Œå¯åŠ¨å®¹å™¨ç›¸å½“äºå¯åŠ¨æœ¬æœºçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œè€Œä¸æ˜¯å¯åŠ¨ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œé€Ÿåº¦å°±å¿«å¾ˆå¤šã€‚\n\n- **èµ„æºå ç”¨å°‘ã€‚**å®¹å™¨åªå ç”¨éœ€è¦çš„èµ„æºï¼Œä¸å ç”¨é‚£äº›æ²¡æœ‰ç”¨åˆ°çš„èµ„æºï¼›è™šæ‹Ÿæœºç”±äºæ˜¯å®Œæ•´çš„æ“ä½œç³»ç»Ÿï¼Œä¸å¯é¿å…è¦å ç”¨æ‰€æœ‰èµ„æºã€‚å¦å¤–ï¼Œå¤šä¸ªå®¹å™¨å¯ä»¥å…±äº«èµ„æºï¼Œè™šæ‹Ÿæœºéƒ½æ˜¯ç‹¬äº«èµ„æºã€‚\n\n- **ä½“ç§¯å°ã€‚**å®¹å™¨åªè¦åŒ…å«ç”¨åˆ°çš„ç»„ä»¶å³å¯ï¼Œè€Œè™šæ‹Ÿæœºæ˜¯æ•´ä¸ªæ“ä½œç³»ç»Ÿçš„æ‰“åŒ…ï¼Œæ‰€ä»¥å®¹å™¨æ–‡ä»¶æ¯”è™šæ‹Ÿæœºæ–‡ä»¶è¦å°å¾ˆå¤šã€‚\n\næ€»ä¹‹ï¼Œå®¹å™¨æœ‰ç‚¹åƒè½»é‡çº§çš„è™šæ‹Ÿæœºï¼Œèƒ½å¤Ÿæä¾›è™šæ‹ŸåŒ–çš„ç¯å¢ƒï¼Œä½†æ˜¯æˆæœ¬å¼€é”€å°å¾—å¤šã€‚\n\n## å››ã€Dockeræ˜¯ä»€ä¹ˆï¼Ÿ\n\n**Docker å±äº Linux å®¹å™¨çš„ä¸€ç§å°è£…ï¼Œæä¾›ç®€å•æ˜“ç”¨çš„å®¹å™¨ä½¿ç”¨æ¥å£ã€‚**å®ƒæ˜¯ç›®å‰æœ€æµè¡Œçš„ Linux å®¹å™¨è§£å†³æ–¹æ¡ˆã€‚\n\nDocker å°†åº”ç”¨ç¨‹åºä¸è¯¥ç¨‹åºçš„ä¾èµ–ï¼Œæ‰“åŒ…åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ã€‚è¿è¡Œè¿™ä¸ªæ–‡ä»¶ï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿå®¹å™¨ã€‚ç¨‹åºåœ¨è¿™ä¸ªè™šæ‹Ÿå®¹å™¨é‡Œè¿è¡Œï¼Œå°±å¥½åƒåœ¨çœŸå®çš„ç‰©ç†æœºä¸Šè¿è¡Œä¸€æ ·ã€‚æœ‰äº† Dockerï¼Œå°±ä¸ç”¨æ‹…å¿ƒç¯å¢ƒé—®é¢˜ã€‚\n\næ€»ä½“æ¥è¯´ï¼ŒDocker çš„æ¥å£ç›¸å½“ç®€å•ï¼Œç”¨æˆ·å¯ä»¥æ–¹ä¾¿åœ°åˆ›å»ºå’Œä½¿ç”¨å®¹å™¨ï¼ŒæŠŠè‡ªå·±çš„åº”ç”¨æ”¾å…¥å®¹å™¨ã€‚å®¹å™¨è¿˜å¯ä»¥è¿›è¡Œç‰ˆæœ¬ç®¡ç†ã€å¤åˆ¶ã€åˆ†äº«ã€ä¿®æ”¹ï¼Œå°±åƒç®¡ç†æ™®é€šçš„ä»£ç ä¸€æ ·ã€‚\n\n## äº”ã€Dockerçš„ç”¨é€”\n\nDocker çš„ä¸»è¦ç”¨é€”ï¼Œç›®å‰æœ‰ä¸‰å¤§ç±»ã€‚\n\n- **æä¾›ä¸€æ¬¡æ€§çš„ç¯å¢ƒã€‚**æ¯”å¦‚ï¼Œæœ¬åœ°æµ‹è¯•ä»–äººçš„è½¯ä»¶ã€æŒç»­é›†æˆçš„æ—¶å€™æä¾›å•å…ƒæµ‹è¯•å’Œæ„å»ºçš„ç¯å¢ƒã€‚\n\n- **æä¾›å¼¹æ€§çš„äº‘æœåŠ¡ã€‚**å› ä¸º Docker å®¹å™¨å¯ä»¥éšå¼€éšå…³ï¼Œå¾ˆé€‚åˆåŠ¨æ€æ‰©å®¹å’Œç¼©å®¹ã€‚\n\n- **ç»„å»ºå¾®æœåŠ¡æ¶æ„ã€‚**é€šè¿‡å¤šä¸ªå®¹å™¨ï¼Œä¸€å°æœºå™¨å¯ä»¥è·‘å¤šä¸ªæœåŠ¡ï¼Œå› æ­¤åœ¨æœ¬æœºå°±å¯ä»¥æ¨¡æ‹Ÿå‡ºå¾®æœåŠ¡æ¶æ„ã€‚\n\n## å…­ã€Docker çš„å®‰è£…\n\nDocker æ˜¯ä¸€ä¸ªå¼€æºçš„å•†ä¸šäº§å“ï¼Œæœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼šç¤¾åŒºç‰ˆï¼ˆCommunity Editionï¼Œç¼©å†™ä¸º CEï¼‰å’Œä¼ä¸šç‰ˆï¼ˆEnterprise Editionï¼Œç¼©å†™ä¸º EEï¼‰ã€‚ä¼ä¸šç‰ˆåŒ…å«äº†ä¸€äº›æ”¶è´¹æœåŠ¡ï¼Œä¸ªäººå¼€å‘è€…ä¸€èˆ¬ç”¨ä¸åˆ°ã€‚ä¸‹é¢çš„ä»‹ç»éƒ½é’ˆå¯¹ç¤¾åŒºç‰ˆã€‚\n\nDocker CE çš„å®‰è£…è¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£ã€‚\n\n\u003e - [Mac](https://docs.docker.com/docker-for-mac/install/)\n\u003e\n\u003e - [Windows](https://docs.docker.com/docker-for-windows/install/)\n\u003e\n\u003e - [Ubuntu](https://docs.docker.com/install/linux/docker-ce/ubuntu/)\n\u003e\n\u003e - ã€‚ã€‚ã€‚\n\nå®‰è£…å®Œæˆåï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒéªŒè¯æ˜¯å¦å®‰è£…æˆåŠŸã€‚\n\n```Bash\n$ docker version\n# æˆ–è€…\n$ docker info\n```\n\nDocker éœ€è¦ç”¨æˆ·å…·æœ‰ sudo æƒé™ï¼Œä¸ºäº†é¿å…æ¯æ¬¡å‘½ä»¤éƒ½è¾“å…¥`sudo`ï¼Œå¯ä»¥æŠŠç”¨æˆ·åŠ å…¥ Docker ç”¨æˆ·ç»„ï¼ˆ[å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/install/linux/linux-postinstall/#manage-docker-as-a-non-root-user)ï¼‰ã€‚\n\n```Bash\nsudo usermod -aG docker $USER\n# éœ€è¦log out æ‰èƒ½ç”Ÿæ•ˆï¼Œä¸è®©docker infoå‘½ä»¤çš„Severéƒ¨åˆ†ä¼šæŠ¥é”™\n# è¯¦æƒ…è§ï¼šhttps://docs.docker.com/engine/install/linux-postinstall/\n```\n\nDocker æ˜¯æœåŠ¡å™¨----å®¢æˆ·ç«¯æ¶æ„ã€‚å‘½ä»¤è¡Œè¿è¡Œ`docker`å‘½ä»¤çš„æ—¶å€™ï¼Œéœ€è¦æœ¬æœºæœ‰ Docker æœåŠ¡ã€‚å¦‚æœè¿™é¡¹æœåŠ¡æ²¡æœ‰å¯åŠ¨ï¼Œå¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤å¯åŠ¨ï¼ˆ[å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/config/daemon/systemd/)ï¼‰ã€‚\n\n```Bash\n# service å‘½ä»¤çš„ç”¨æ³•\n$ sudo service docker start\n\n# systemctl å‘½ä»¤çš„ç”¨æ³•\n$ sudo systemctl start docker\n```\n\nå®‰è£…æˆåŠŸåï¼Œå¯ä»¥\n\n```bash\ndocker run hello-world\n```\n\n![image-20221214173436747](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221214173436747.png)\n\n```\ndocker run -it ubuntu bash\n```\n\n![img](https://j0tzfdufdk.feishu.cn/space/api/box/stream/download/asynccode/?code=NjFiOWIzZjQyNzU5M2FjNzk1OWE4MDJiOWQ4NjZiNDdfcUVQVEZMMzJoaUpIbmR3MHMwd1pmU0VhT0RGU002elNfVG9rZW46Ym94Y251TVdWN2hQV2VFY2gzT0ZQWFJGNjNlXzE2NzEwMTA1MDM6MTY3MTAxNDEwM19WNA)\n\nå…¶ä¸­ä¸‹è½½çš„imageå¤§å°æ˜¯30MB\n\n\u003e $ docker image ls\n\u003e\n\u003e REPOSITORY    TAG       IMAGE ID       CREATED         SIZE\n\u003e\n\u003e ubuntu        latest    df5de72bdb3b   2 weeks ago     77.8MB\n\u003e\n\u003e hello-world   latest    feb5d9fea6a5   11 months ago   13.3kB\n\n## ä¸ƒã€image æ–‡ä»¶\n\n**Docker æŠŠåº”ç”¨ç¨‹åºåŠå…¶ä¾èµ–ï¼Œæ‰“åŒ…åœ¨ image æ–‡ä»¶é‡Œé¢ã€‚**åªæœ‰é€šè¿‡è¿™ä¸ªæ–‡ä»¶ï¼Œæ‰èƒ½ç”Ÿæˆ Docker å®¹å™¨ã€‚image æ–‡ä»¶å¯ä»¥çœ‹ä½œæ˜¯å®¹å™¨çš„æ¨¡æ¿ã€‚Docker æ ¹æ® image æ–‡ä»¶ç”Ÿæˆå®¹å™¨çš„å®ä¾‹ã€‚åŒä¸€ä¸ª image æ–‡ä»¶ï¼Œå¯ä»¥ç”Ÿæˆå¤šä¸ªåŒæ—¶è¿è¡Œçš„å®¹å™¨å®ä¾‹ã€‚\n\nimage æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ã€‚å®é™…å¼€å‘ä¸­ï¼Œä¸€ä¸ª image æ–‡ä»¶å¾€å¾€é€šè¿‡ç»§æ‰¿å¦ä¸€ä¸ª image æ–‡ä»¶ï¼ŒåŠ ä¸Šä¸€äº›ä¸ªæ€§åŒ–è®¾ç½®è€Œç”Ÿæˆã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œä½ å¯ä»¥åœ¨ Ubuntu çš„ image åŸºç¡€ä¸Šï¼Œå¾€é‡Œé¢åŠ å…¥ Apache æœåŠ¡å™¨ï¼Œå½¢æˆä½ çš„ imageã€‚\n\nimage æ–‡ä»¶æ˜¯é€šç”¨çš„ï¼Œä¸€å°æœºå™¨çš„ image æ–‡ä»¶æ‹·è´åˆ°å¦ä¸€å°æœºå™¨ï¼Œç…§æ ·å¯ä»¥ä½¿ç”¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¸ºäº†èŠ‚çœæ—¶é—´ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨åˆ«äººåˆ¶ä½œå¥½çš„ image æ–‡ä»¶ï¼Œè€Œä¸æ˜¯è‡ªå·±åˆ¶ä½œã€‚å³ä½¿è¦å®šåˆ¶ï¼Œä¹Ÿåº”è¯¥åŸºäºåˆ«äººçš„ image æ–‡ä»¶è¿›è¡ŒåŠ å·¥ï¼Œè€Œä¸æ˜¯ä»é›¶å¼€å§‹åˆ¶ä½œã€‚\n\nä¸ºäº†æ–¹ä¾¿å…±äº«ï¼Œimage æ–‡ä»¶åˆ¶ä½œå®Œæˆåï¼Œå¯ä»¥ä¸Šä¼ åˆ°ç½‘ä¸Šçš„ä»“åº“ã€‚Docker çš„å®˜æ–¹ä»“åº“ [Docker Hub](https://hub.docker.com/) æ˜¯æœ€é‡è¦ã€æœ€å¸¸ç”¨çš„ image ä»“åº“ã€‚æ­¤å¤–ï¼Œå‡ºå”®è‡ªå·±åˆ¶ä½œçš„ image æ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚\n\n## å…«ã€å®ä¾‹ï¼šhello world\n\nä¸‹é¢ï¼Œæˆ‘ä»¬é€šè¿‡æœ€ç®€å•çš„ image æ–‡ä»¶\"[hello world\"](https://hub.docker.com/r/library/hello-world/)ï¼Œæ„Ÿå—ä¸€ä¸‹ Dockerã€‚\n\néœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå›½å†…è¿æ¥ Docker çš„å®˜æ–¹ä»“åº“å¾ˆæ…¢ï¼Œè¿˜ä¼šæ–­çº¿ï¼Œéœ€è¦å°†é»˜è®¤ä»“åº“æ”¹æˆå›½å†…çš„é•œåƒç½‘ç«™ï¼Œå…·ä½“çš„ä¿®æ”¹æ–¹æ³•åœ¨[ä¸‹ä¸€ç¯‡æ–‡ç« ](https://www.ruanyifeng.com/blog/2018/02/docker-wordpress-tutorial.html)çš„ç¬¬ä¸€èŠ‚ã€‚æœ‰éœ€è¦çš„æœ‹å‹ï¼Œå¯ä»¥å…ˆçœ‹ä¸€ä¸‹ã€‚\n\né¦–å…ˆï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°† image æ–‡ä»¶ä»ä»“åº“æŠ“å–åˆ°æœ¬åœ°ã€‚\n\n```Bash\n$ docker image pull library/hello-world\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œ`docker image pull`æ˜¯æŠ“å– image æ–‡ä»¶çš„å‘½ä»¤ã€‚`library/hello-world`æ˜¯ image æ–‡ä»¶åœ¨ä»“åº“é‡Œé¢çš„ä½ç½®ï¼Œå…¶ä¸­`library`æ˜¯ image æ–‡ä»¶æ‰€åœ¨çš„ç»„ï¼Œ`hello-world`æ˜¯ image æ–‡ä»¶çš„åå­—ã€‚\n\nç”±äº Docker å®˜æ–¹æä¾›çš„ image æ–‡ä»¶ï¼Œéƒ½æ”¾åœ¨`library`ç»„é‡Œé¢ï¼Œæ‰€ä»¥å®ƒçš„æ˜¯é»˜è®¤ç»„ï¼Œå¯ä»¥çœç•¥ã€‚å› æ­¤ï¼Œä¸Šé¢çš„å‘½ä»¤å¯ä»¥å†™æˆä¸‹é¢è¿™æ ·ã€‚\n\n```Bash\n$ docker image pull hello-world\n```\n\næŠ“å–æˆåŠŸä»¥åï¼Œå°±å¯ä»¥åœ¨æœ¬æœºçœ‹åˆ°è¿™ä¸ª image æ–‡ä»¶äº†ã€‚\n\n```Bash\n$ docker image ls\n```\n\nç°åœ¨ï¼Œè¿è¡Œè¿™ä¸ª image æ–‡ä»¶ã€‚\n\n```Bash\n$ docker container run hello-world\n```\n\n`docker container run`å‘½ä»¤ä¼šä» image æ–‡ä»¶ï¼Œç”Ÿæˆä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„å®¹å™¨å®ä¾‹ã€‚\n\næ³¨æ„ï¼Œ`docker container run`å‘½ä»¤å…·æœ‰è‡ªåŠ¨æŠ“å– image æ–‡ä»¶çš„åŠŸèƒ½ã€‚å¦‚æœå‘ç°æœ¬åœ°æ²¡æœ‰æŒ‡å®šçš„ image æ–‡ä»¶ï¼Œå°±ä¼šä»ä»“åº“è‡ªåŠ¨æŠ“å–ã€‚å› æ­¤ï¼Œå‰é¢çš„`docker image pull`å‘½ä»¤å¹¶ä¸æ˜¯å¿…éœ€çš„æ­¥éª¤ã€‚\n\nå¦‚æœè¿è¡ŒæˆåŠŸï¼Œä½ ä¼šåœ¨å±å¹•ä¸Šè¯»åˆ°ä¸‹é¢çš„è¾“å‡ºã€‚\n\n```Bash\n$ docker container run hello-world\n\nHello from Docker!\nThis message shows that your installation appears to be working correctly.... ...\n```\n\nè¾“å‡ºè¿™æ®µæç¤ºä»¥åï¼Œ`hello world`å°±ä¼šåœæ­¢è¿è¡Œï¼Œå®¹å™¨è‡ªåŠ¨ç»ˆæ­¢ã€‚\n\næœ‰äº›å®¹å™¨ä¸ä¼šè‡ªåŠ¨ç»ˆæ­¢ï¼Œå› ä¸ºæä¾›çš„æ˜¯æœåŠ¡ã€‚æ¯”å¦‚ï¼Œå®‰è£…è¿è¡Œ Ubuntu çš„ imageï¼Œå°±å¯ä»¥åœ¨å‘½ä»¤è¡Œä½“éªŒ Ubuntu ç³»ç»Ÿã€‚\n\n```Bash\n$ docker container run -it ubuntu bash\n```\n\nå¯¹äºé‚£äº›ä¸ä¼šè‡ªåŠ¨ç»ˆæ­¢çš„å®¹å™¨ï¼Œå¿…é¡»ä½¿ç”¨`docker container kill` å‘½ä»¤æ‰‹åŠ¨ç»ˆæ­¢ã€‚\n\n```Bash\n$ docker container kill [containID]\n\n## å¦‚ä¸‹ä¾‹å­\n$ docker container ls\nCONTAINER ID   IMAGE     COMMAND   CREATED          STATUS          PORTS     NAMES\nf45ef5fcc683   ubuntu    \"bash\"    21 minutes ago   Up 21 minutes             charming_montalcini\n\n# happy3 @ happy3-HX in ~ [15:46:39] \n$ docker kill f45ef5fcc683\nf45ef5fcc683\n\n# happy3 @ happy3-HX in ~ [15:46:47] \n$ docker container ls     \nCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n\n# happy3 @ happy3-HX in ~ [15:46:54] \n$ \n```\n\n## ä¹ã€å®¹å™¨æ–‡ä»¶\n\n**image æ–‡ä»¶ç”Ÿæˆçš„å®¹å™¨å®ä¾‹ï¼Œæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªæ–‡ä»¶ï¼Œç§°ä¸ºå®¹å™¨æ–‡ä»¶ã€‚**ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦å®¹å™¨ç”Ÿæˆï¼Œå°±ä¼šåŒæ—¶å­˜åœ¨ä¸¤ä¸ªæ–‡ä»¶ï¼š image æ–‡ä»¶å’Œå®¹å™¨æ–‡ä»¶ã€‚è€Œä¸”å…³é—­å®¹å™¨å¹¶ä¸ä¼šåˆ é™¤å®¹å™¨æ–‡ä»¶ï¼Œåªæ˜¯å®¹å™¨åœæ­¢è¿è¡Œè€Œå·²ã€‚\n\nä¸Šé¢å‘½ä»¤çš„è¾“å‡ºç»“æœä¹‹ä¸­ï¼ŒåŒ…æ‹¬å®¹å™¨çš„ IDã€‚å¾ˆå¤šåœ°æ–¹éƒ½éœ€è¦æä¾›è¿™ä¸ª IDï¼Œæ¯”å¦‚ä¸Šä¸€èŠ‚ç»ˆæ­¢å®¹å™¨è¿è¡Œçš„`docker container kill`å‘½ä»¤ã€‚\n\nç»ˆæ­¢è¿è¡Œçš„å®¹å™¨æ–‡ä»¶ï¼Œä¾ç„¶ä¼šå æ®ç¡¬ç›˜ç©ºé—´ï¼Œå¯ä»¥ä½¿ç”¨`docker container rm`å‘½ä»¤åˆ é™¤ã€‚\n\n```Bash\n$ docker container rm [containerID]\n```\n\nè¿è¡Œä¸Šé¢çš„å‘½ä»¤ä¹‹åï¼Œå†ä½¿ç”¨`docker container ls --all`å‘½ä»¤ï¼Œå°±ä¼šå‘ç°è¢«åˆ é™¤çš„å®¹å™¨æ–‡ä»¶å·²ç»æ¶ˆå¤±äº†ã€‚\n\n## åã€Dockerfile æ–‡ä»¶\n\nå­¦ä¼šä½¿ç”¨ image æ–‡ä»¶ä»¥åï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œå¦‚ä½•å¯ä»¥ç”Ÿæˆ image æ–‡ä»¶ï¼Ÿå¦‚æœä½ è¦æ¨å¹¿è‡ªå·±çš„è½¯ä»¶ï¼ŒåŠ¿å¿…è¦è‡ªå·±åˆ¶ä½œ image æ–‡ä»¶ã€‚\n\nè¿™å°±éœ€è¦ç”¨åˆ° Dockerfile æ–‡ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ï¼Œç”¨æ¥é…ç½® imageã€‚Docker æ ¹æ® è¯¥æ–‡ä»¶ç”ŸæˆäºŒè¿›åˆ¶çš„ image æ–‡ä»¶ã€‚\n\nä¸‹é¢é€šè¿‡ä¸€ä¸ªå®ä¾‹ï¼Œæ¼”ç¤ºå¦‚ä½•ç¼–å†™ Dockerfile æ–‡ä»¶ã€‚\n\n## åä¸€ã€å®ä¾‹ï¼šåˆ¶ä½œè‡ªå·±çš„ Docker å®¹å™¨\n\nä¸‹é¢æˆ‘ä»¥ [koa-demos](https://www.ruanyifeng.com/blog/2017/08/koa.html) é¡¹ç›®ä¸ºä¾‹ï¼Œä»‹ç»æ€ä¹ˆå†™ Dockerfile æ–‡ä»¶ï¼Œå®ç°è®©ç”¨æˆ·åœ¨ Docker å®¹å™¨é‡Œé¢è¿è¡Œ Koa æ¡†æ¶ã€‚\n\nä½œä¸ºå‡†å¤‡å·¥ä½œï¼Œè¯·å…ˆ[ä¸‹è½½æºç ](https://github.com/ruanyf/koa-demos/archive/master.zip)ã€‚\n\n```Bash\n$ git clone https://github.com/ruanyf/koa-demos.git\n$ cd koa-demos\n```\n\n#### 11.1 ç¼–å†™ Dockerfile æ–‡ä»¶\n\né¦–å…ˆï¼Œåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶`.dockerignore`ï¼Œå†™å…¥ä¸‹é¢çš„[å†…iå®¹](https://github.com/ruanyf/koa-demos/blob/master/.dockerignore)ã€‚\n\n```Bash\n.git\nnode_modules\nnpm-debug.log\n```\n\nä¸Šé¢ä»£ç è¡¨ç¤ºï¼Œè¿™ä¸‰ä¸ªè·¯å¾„è¦æ’é™¤ï¼Œä¸è¦æ‰“åŒ…è¿›å…¥ image æ–‡ä»¶ã€‚å¦‚æœä½ æ²¡æœ‰è·¯å¾„è¦æ’é™¤ï¼Œè¿™ä¸ªæ–‡ä»¶å¯ä»¥ä¸æ–°å»ºã€‚\n\nç„¶åï¼Œåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹ï¼Œæ–°å»ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ Dockerfileï¼Œå†™å…¥ä¸‹é¢çš„[å†…å®¹](https://github.com/ruanyf/koa-demos/blob/master/Dockerfile)ã€‚\n\n```Bash\nFROM node:8.4\nCOPY . /app\nWORKDIR /app\nRUN npm install --registry=https://registry.npm.taobao.org\nEXPOSE 3000\n```\n\nä¸Šé¢ä»£ç ä¸€å…±äº”è¡Œï¼Œå«ä¹‰å¦‚ä¸‹ã€‚\n\n\u003e - `FROM node:8.4`ï¼šè¯¥ image æ–‡ä»¶ç»§æ‰¿å®˜æ–¹çš„ node imageï¼Œå†’å·è¡¨ç¤ºæ ‡ç­¾ï¼Œè¿™é‡Œæ ‡ç­¾æ˜¯`8.4`ï¼Œå³8.4ç‰ˆæœ¬çš„ nodeã€‚\n\u003e\n\u003e - `COPY . /app`ï¼šå°†å½“å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ˆé™¤äº†`.dockerignore`æ’é™¤çš„è·¯å¾„ï¼‰ï¼Œéƒ½æ‹·è´è¿›å…¥ image æ–‡ä»¶çš„`/app`ç›®å½•ã€‚\n\u003e\n\u003e - `WORKDIR /app`ï¼šæŒ‡å®šæ¥ä¸‹æ¥çš„å·¥ä½œè·¯å¾„ä¸º`/app`ã€‚\n\u003e\n\u003e - `RUN npm install`ï¼šåœ¨`/app`ç›®å½•ä¸‹ï¼Œè¿è¡Œ`npm install`å‘½ä»¤å®‰è£…ä¾èµ–ã€‚æ³¨æ„ï¼Œå®‰è£…åæ‰€æœ‰çš„ä¾èµ–ï¼Œéƒ½å°†æ‰“åŒ…è¿›å…¥ image æ–‡ä»¶ã€‚\n\u003e\n\u003e - `EXPOSE 3000`ï¼šå°†å®¹å™¨ 3000 ç«¯å£æš´éœ²å‡ºæ¥ï¼Œ å…è®¸å¤–éƒ¨è¿æ¥è¿™ä¸ªç«¯å£ã€‚\n\n#### 11.2 åˆ›å»º image æ–‡ä»¶\n\næœ‰äº† Dockerfile æ–‡ä»¶ä»¥åï¼Œå°±å¯ä»¥ä½¿ç”¨`docker image build`å‘½ä»¤åˆ›å»º image æ–‡ä»¶äº†ã€‚\n\n```Bash\n$ docker image build -t koa-demo .\n# æˆ–è€…\n$ docker image build -t koa-demo:0.0.1 .\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œ`-t`å‚æ•°ç”¨æ¥æŒ‡å®š image æ–‡ä»¶çš„åå­—ï¼Œåé¢è¿˜å¯ä»¥ç”¨å†’å·æŒ‡å®šæ ‡ç­¾ã€‚å¦‚æœä¸æŒ‡å®šï¼Œé»˜è®¤çš„æ ‡ç­¾å°±æ˜¯`latest`ã€‚æœ€åçš„é‚£ä¸ªç‚¹è¡¨ç¤º Dockerfile æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ï¼Œä¸Šä¾‹æ˜¯å½“å‰è·¯å¾„ï¼Œæ‰€ä»¥æ˜¯ä¸€ä¸ªç‚¹ã€‚\n\nå¦‚æœè¿è¡ŒæˆåŠŸï¼Œå°±å¯ä»¥çœ‹åˆ°æ–°ç”Ÿæˆçš„ image æ–‡ä»¶`koa-demo`äº†ã€‚\n\n```Bash\n$ docker image ls\n```\n\n![img](https://j0tzfdufdk.feishu.cn/space/api/box/stream/download/asynccode/?code=MzYxMzM4ODE4NDUzYmE0YjYxNTc5OTFlZTUwY2E1YzBfNTNROGhKNEh3cHp2MW1CUFQ1N3BuYVNUUU9EZ1FySWJfVG9rZW46Ym94Y25LR0tnREtkcGJ1M1dTVk9HN3JuZUxnXzE2NzEwMTA1MDM6MTY3MTAxNDEwM19WNA)\n\n#### 11.3 ç”Ÿæˆå®¹å™¨\n\n`docker container run`å‘½ä»¤ä¼šä» image æ–‡ä»¶ç”Ÿæˆå®¹å™¨ã€‚\n\n```Bash\n$ docker container run -p 8000:3000 -it koa-demo /bin/bash\n# æˆ–è€…\n$ docker container run -p 8000:3000 -it koa-demo:0.0.1 /bin/bash\n```\n\nä¸Šé¢å‘½ä»¤çš„å„ä¸ªå‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š\n\n\u003e - `-p`å‚æ•°ï¼šå®¹å™¨çš„ 3000 ç«¯å£æ˜ å°„åˆ°æœ¬æœºçš„ 8000 ç«¯å£ã€‚\n\u003e\n\u003e - `-it`å‚æ•°ï¼šå®¹å™¨çš„ Shell æ˜ å°„åˆ°å½“å‰çš„ Shellï¼Œç„¶åä½ åœ¨æœ¬æœºçª—å£è¾“å…¥çš„å‘½ä»¤ï¼Œå°±ä¼šä¼ å…¥å®¹å™¨ã€‚\n\u003e\n\u003e - `koa-demo:0.0.1`ï¼šimage æ–‡ä»¶çš„åå­—ï¼ˆå¦‚æœæœ‰æ ‡ç­¾ï¼Œè¿˜éœ€è¦æä¾›æ ‡ç­¾ï¼Œé»˜è®¤æ˜¯ latest æ ‡ç­¾ï¼‰ã€‚\n\u003e\n\u003e - `/bin/bash`ï¼šå®¹å™¨å¯åŠ¨ä»¥åï¼Œå†…éƒ¨ç¬¬ä¸€ä¸ªæ‰§è¡Œçš„å‘½ä»¤ã€‚è¿™é‡Œæ˜¯å¯åŠ¨ Bashï¼Œä¿è¯ç”¨æˆ·å¯ä»¥ä½¿ç”¨ Shellã€‚\n\nå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œè¿è¡Œä¸Šé¢çš„å‘½ä»¤ä»¥åï¼Œå°±ä¼šè¿”å›ä¸€ä¸ªå‘½ä»¤è¡Œæç¤ºç¬¦ã€‚\n\n```Bash\nroot@66d80f4aaf1e:/app#\n```\n\nè¿™è¡¨ç¤ºä½ å·²ç»åœ¨å®¹å™¨é‡Œé¢äº†ï¼Œè¿”å›çš„æç¤ºç¬¦å°±æ˜¯å®¹å™¨å†…éƒ¨çš„ Shell æç¤ºç¬¦ã€‚æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚\n\n```Bash\nroot@66d80f4aaf1e:/app# node demos/01.js\n```\n\nè¿™æ—¶ï¼ŒKoa æ¡†æ¶å·²ç»è¿è¡Œèµ·æ¥äº†ã€‚æ‰“å¼€æœ¬æœºçš„æµè§ˆå™¨ï¼Œè®¿é—® http://127.0.0.1:8000ï¼Œç½‘é¡µæ˜¾ç¤º\"Not Found\"ï¼Œè¿™æ˜¯å› ä¸ºè¿™ä¸ª [demo](https://github.com/ruanyf/koa-demos/blob/master/demos/01.js) æ²¡æœ‰å†™è·¯ç”±ã€‚\n\nè¿™ä¸ªä¾‹å­ä¸­ï¼ŒNode è¿›ç¨‹è¿è¡Œåœ¨ Docker å®¹å™¨çš„è™šæ‹Ÿç¯å¢ƒé‡Œé¢ï¼Œè¿›ç¨‹æ¥è§¦åˆ°çš„æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œæ¥å£éƒ½æ˜¯è™šæ‹Ÿçš„ï¼Œä¸æœ¬æœºçš„æ–‡ä»¶ç³»ç»Ÿå’Œç½‘ç»œæ¥å£æ˜¯éš”ç¦»çš„ï¼Œå› æ­¤éœ€è¦å®šä¹‰å®¹å™¨ä¸ç‰©ç†æœºçš„ç«¯å£æ˜ å°„ï¼ˆmapï¼‰ã€‚\n\nç°åœ¨ï¼Œåœ¨å®¹å™¨çš„å‘½ä»¤è¡Œï¼ŒæŒ‰ä¸‹ Ctrl + c åœæ­¢ Node è¿›ç¨‹ï¼Œç„¶åæŒ‰ä¸‹ Ctrl + d ï¼ˆæˆ–è€…è¾“å…¥ exitï¼‰é€€å‡ºå®¹å™¨ã€‚æ­¤å¤–ï¼Œä¹Ÿå¯ä»¥ç”¨`docker container kill`ç»ˆæ­¢å®¹å™¨è¿è¡Œã€‚\n\n```Bash\n# åœ¨æœ¬æœºçš„å¦ä¸€ä¸ªç»ˆç«¯çª—å£ï¼ŒæŸ¥å‡ºå®¹å™¨çš„ ID\n$ docker container ls\n\n# åœæ­¢æŒ‡å®šçš„å®¹å™¨è¿è¡Œ\n$ docker container kill [containerID]\n```\n\nå®¹å™¨åœæ­¢è¿è¡Œä¹‹åï¼Œå¹¶ä¸ä¼šæ¶ˆå¤±ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤åˆ é™¤å®¹å™¨æ–‡ä»¶ã€‚\n\n```Bash\n# æŸ¥å‡ºå®¹å™¨çš„ ID\n$ docker container ls --all\n\n# åˆ é™¤æŒ‡å®šçš„å®¹å™¨æ–‡ä»¶\n$ docker container rm [containerID]\n```\n\nä¹Ÿå¯ä»¥ä½¿ç”¨`docker container run`å‘½ä»¤çš„`--rm`å‚æ•°ï¼Œåœ¨å®¹å™¨ç»ˆæ­¢è¿è¡Œåè‡ªåŠ¨åˆ é™¤å®¹å™¨æ–‡ä»¶ã€‚\n\n```Bash\n$ docker container run --rm -p 8000:3000 -it koa-demo /bin/bash\n```\n\n#### 11.4 CMD å‘½ä»¤\n\nä¸Šä¸€èŠ‚çš„ä¾‹å­é‡Œé¢ï¼Œå®¹å™¨å¯åŠ¨ä»¥åï¼Œéœ€è¦æ‰‹åŠ¨è¾“å…¥å‘½ä»¤`node demos/01.js`ã€‚æˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªå‘½ä»¤å†™åœ¨ Dockerfile é‡Œé¢ï¼Œè¿™æ ·å®¹å™¨å¯åŠ¨ä»¥åï¼Œè¿™ä¸ªå‘½ä»¤å°±å·²ç»æ‰§è¡Œäº†ï¼Œä¸ç”¨å†æ‰‹åŠ¨è¾“å…¥äº†ã€‚\n\n```Bash\nFROM node:8.4\nCOPY . /app\nWORKDIR /app\nRUN npm install --registry=https://registry.npm.taobao.org\nEXPOSE 3000\nCMD node demos/01.js\n```\n\nä¸Šé¢çš„ Dockerfile é‡Œé¢ï¼Œå¤šäº†æœ€åä¸€è¡Œ`CMD node demos/01.js`ï¼Œå®ƒè¡¨ç¤ºå®¹å™¨å¯åŠ¨åè‡ªåŠ¨æ‰§è¡Œ`node demos/01.js`ã€‚\n\nä½ å¯èƒ½ä¼šé—®ï¼Œ`RUN`å‘½ä»¤ä¸`CMD`å‘½ä»¤çš„åŒºåˆ«åœ¨å“ªé‡Œï¼Ÿç®€å•è¯´ï¼Œ`RUN`å‘½ä»¤åœ¨ image æ–‡ä»¶çš„æ„å»ºé˜¶æ®µæ‰§è¡Œï¼Œæ‰§è¡Œç»“æœéƒ½ä¼šæ‰“åŒ…è¿›å…¥ image æ–‡ä»¶ï¼›`CMD`å‘½ä»¤åˆ™æ˜¯åœ¨å®¹å™¨å¯åŠ¨åæ‰§è¡Œã€‚å¦å¤–ï¼Œä¸€ä¸ª Dockerfile å¯ä»¥åŒ…å«å¤šä¸ª`RUN`å‘½ä»¤ï¼Œä½†æ˜¯åªèƒ½æœ‰ä¸€ä¸ª`CMD`å‘½ä»¤ã€‚\n\næ³¨æ„ï¼ŒæŒ‡å®šäº†`CMD`å‘½ä»¤ä»¥åï¼Œ`docker container run`å‘½ä»¤å°±ä¸èƒ½é™„åŠ å‘½ä»¤äº†ï¼ˆæ¯”å¦‚å‰é¢çš„`/bin/bash`ï¼‰ï¼Œå¦åˆ™å®ƒä¼šè¦†ç›–`CMD`å‘½ä»¤ã€‚ç°åœ¨ï¼Œå¯åŠ¨å®¹å™¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤ã€‚\n\n```Bash\n$ docker container run --rm -p 8000:3000 -it koa-demo:0.0.1\n```\n\n#### 11.5 å‘å¸ƒ image æ–‡ä»¶\n\nå®¹å™¨è¿è¡ŒæˆåŠŸåï¼Œå°±ç¡®è®¤äº† image æ–‡ä»¶çš„æœ‰æ•ˆæ€§ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è€ƒè™‘æŠŠ image æ–‡ä»¶åˆ†äº«åˆ°ç½‘ä¸Šï¼Œè®©å…¶ä»–äººä½¿ç”¨ã€‚\n\né¦–å…ˆï¼Œå» [hub.docker.com](https://hub.docker.com/) æˆ– [cloud.docker.com](https://cloud.docker.com/) æ³¨å†Œä¸€ä¸ªè´¦æˆ·ã€‚ç„¶åï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤ç™»å½•ã€‚\n\n```Bash\n$ docker login\n```\n\næ¥ç€ï¼Œä¸ºæœ¬åœ°çš„ image æ ‡æ³¨ç”¨æˆ·åå’Œç‰ˆæœ¬ã€‚\n\n```Bash\n$ docker image tag [imageName] [username]/[repository]:[tag]\n# å®ä¾‹\n$ docker image tag koa-demos:0.0.1 ruanyf/koa-demos:0.0.1\n```\n\nä¹Ÿå¯ä»¥ä¸æ ‡æ³¨ç”¨æˆ·åï¼Œé‡æ–°æ„å»ºä¸€ä¸‹ image æ–‡ä»¶ã€‚\n\n```Bash\n$ docker image build -t [username]/[repository]:[tag] .\n```\n\næœ€åï¼Œå‘å¸ƒ image æ–‡ä»¶ã€‚\n\n```Bash\n$ docker image push [username]/[repository]:[tag]\n```\n\nå‘å¸ƒæˆåŠŸä»¥åï¼Œç™»å½• hub.docker.comï¼Œå°±å¯ä»¥çœ‹åˆ°å·²ç»å‘å¸ƒçš„ image æ–‡ä»¶ã€‚\n\n### åäºŒã€å…¶ä»–æœ‰ç”¨çš„å‘½ä»¤\n\ndocker çš„ä¸»è¦ç”¨æ³•å°±æ˜¯ä¸Šé¢è¿™äº›ï¼Œæ­¤å¤–è¿˜æœ‰å‡ ä¸ªå‘½ä»¤ï¼Œä¹Ÿéå¸¸æœ‰ç”¨ã€‚\n\n**ï¼ˆ1ï¼‰docker container start**\n\nå‰é¢çš„`docker container run`å‘½ä»¤æ˜¯æ–°å»ºå®¹å™¨ï¼Œæ¯è¿è¡Œä¸€æ¬¡ï¼Œå°±ä¼šæ–°å»ºä¸€ä¸ªå®¹å™¨ã€‚åŒæ ·çš„å‘½ä»¤è¿è¡Œä¸¤æ¬¡ï¼Œå°±ä¼šç”Ÿæˆä¸¤ä¸ªä¸€æ¨¡ä¸€æ ·çš„å®¹å™¨æ–‡ä»¶ã€‚å¦‚æœå¸Œæœ›é‡å¤ä½¿ç”¨å®¹å™¨ï¼Œå°±è¦ä½¿ç”¨`docker container start`å‘½ä»¤ï¼Œå®ƒç”¨æ¥å¯åŠ¨å·²ç»ç”Ÿæˆã€å·²ç»åœæ­¢è¿è¡Œçš„å®¹å™¨æ–‡ä»¶ã€‚\n\n```Bash\n$ docker container start [containerID]\n```\n\n**ï¼ˆ2ï¼‰docker container stop**\n\nå‰é¢çš„`docker container kill`å‘½ä»¤ç»ˆæ­¢å®¹å™¨è¿è¡Œï¼Œç›¸å½“äºå‘å®¹å™¨é‡Œé¢çš„ä¸»è¿›ç¨‹å‘å‡º SIGKILL ä¿¡å·ã€‚è€Œ`docker container stop`å‘½ä»¤ä¹Ÿæ˜¯ç”¨æ¥ç»ˆæ­¢å®¹å™¨è¿è¡Œï¼Œç›¸å½“äºå‘å®¹å™¨é‡Œé¢çš„ä¸»è¿›ç¨‹å‘å‡º SIGTERM ä¿¡å·ï¼Œç„¶åè¿‡ä¸€æ®µæ—¶é—´å†å‘å‡º SIGKILL ä¿¡å·ã€‚\n\n```Bash\n$ docker container stop [containerID]\n```\n\nè¿™ä¸¤ä¸ªä¿¡å·çš„å·®åˆ«æ˜¯ï¼Œåº”ç”¨ç¨‹åºæ”¶åˆ° SIGTERM ä¿¡å·ä»¥åï¼Œå¯ä»¥è‡ªè¡Œè¿›è¡Œæ”¶å°¾æ¸…ç†å·¥ä½œï¼Œä½†ä¹Ÿå¯ä»¥ä¸ç†ä¼šè¿™ä¸ªä¿¡å·ã€‚å¦‚æœæ”¶åˆ° SIGKILL ä¿¡å·ï¼Œå°±ä¼šå¼ºè¡Œç«‹å³ç»ˆæ­¢ï¼Œé‚£äº›æ­£åœ¨è¿›è¡Œä¸­çš„æ“ä½œä¼šå…¨éƒ¨ä¸¢å¤±ã€‚\n\n**ï¼ˆ3ï¼‰docker container logs**\n\n`docker container logs`å‘½ä»¤ç”¨æ¥æŸ¥çœ‹ docker å®¹å™¨çš„è¾“å‡ºï¼Œå³å®¹å™¨é‡Œé¢ Shell çš„æ ‡å‡†è¾“å‡ºã€‚å¦‚æœ`docker run`å‘½ä»¤è¿è¡Œå®¹å™¨çš„æ—¶å€™ï¼Œæ²¡æœ‰ä½¿ç”¨`-it`å‚æ•°ï¼Œå°±è¦ç”¨è¿™ä¸ªå‘½ä»¤æŸ¥çœ‹è¾“å‡ºã€‚\n\n```Bash\n$ docker container logs [containerID]\n```\n\n**ï¼ˆ4ï¼‰docker container exec**\n\n`docker container exec`å‘½ä»¤ç”¨äºè¿›å…¥ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ docker å®¹å™¨ã€‚å¦‚æœ`docker run`å‘½ä»¤è¿è¡Œå®¹å™¨çš„æ—¶å€™ï¼Œæ²¡æœ‰ä½¿ç”¨`-it`å‚æ•°ï¼Œå°±è¦ç”¨è¿™ä¸ªå‘½ä»¤è¿›å…¥å®¹å™¨ã€‚ä¸€æ—¦è¿›å…¥äº†å®¹å™¨ï¼Œå°±å¯ä»¥åœ¨å®¹å™¨çš„ Shell æ‰§è¡Œå‘½ä»¤äº†ã€‚\n\n```Bash\n$ docker container exec -it [containerID] /bin/bash\n```\n\n**ï¼ˆ5ï¼‰docker container cp**\n\n`docker container cp`å‘½ä»¤ç”¨äºä»æ­£åœ¨è¿è¡Œçš„ Docker å®¹å™¨é‡Œé¢ï¼Œå°†æ–‡ä»¶æ‹·è´åˆ°æœ¬æœºã€‚ä¸‹é¢æ˜¯æ‹·è´åˆ°å½“å‰ç›®å½•çš„å†™æ³•ã€‚\n\n```Bash\n$ docker container cp [containID]:[/path/to/file] .\n```\n\n\n\nDone!\n\nè¿›ä¸€æ­¥å®è·µï¼Œå‚è€ƒï¼š\n\n* [Dockerè¿›é˜¶ï¼šstep by step](notes/hands-on-docker_2.md)\n\n","lastmodified":"2022-12-14T10:05:00.50340721Z","tags":null},"/notes/hands-on-docker_2":{"title":"Dockerå…¥é—¨æ•™ç¨‹","content":"\n# Dockerè¿›é˜¶ï¼šstep by step\n\n## 0. å‚è€ƒ\n\n[Docker å¾®æœåŠ¡æ•™ç¨‹](https://www.ruanyifeng.com/blog/2018/02/docker-wordpress-tutorial.html)\n\nå‰ç½®æ•™ç¨‹ï¼š\n\n* [Dockerå…¥é—¨ï¼šstep by step](notes/hands-on-docker_1.md)\n\n### ä¸€ã€é¢„å¤‡å·¥ä½œï¼šimage ä»“åº“çš„é•œåƒç½‘å€\n\næœ¬æ•™ç¨‹éœ€è¦ä»ä»“åº“ä¸‹è½½ image æ–‡ä»¶ï¼Œä½†æ˜¯å›½å†…è®¿é—® Docker çš„å®˜æ–¹ä»“åº“å¾ˆæ…¢ï¼Œè¿˜ç»å¸¸æ–­çº¿ï¼Œæ‰€ä»¥è¦æŠŠä»“åº“ç½‘å€æ”¹æˆå›½å†…çš„é•œåƒç«™ã€‚è¿™é‡Œæ¨èä½¿ç”¨å®˜æ–¹é•œåƒ registry.docker-cn.com ã€‚ä¸‹é¢æ˜¯æˆ‘çš„ Debian ç³»ç»Ÿçš„é»˜è®¤ä»“åº“ä¿®æ”¹æ–¹æ³•ï¼Œå…¶ä»–ç³»ç»Ÿçš„ä¿®æ”¹æ–¹æ³•å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://www.docker-cn.com/registry-mirror)ã€‚\n\næ‰“å¼€`/etc/default/docker`æ–‡ä»¶ï¼ˆéœ€è¦`sudo`æƒé™ï¼‰ï¼Œåœ¨æ–‡ä»¶çš„åº•éƒ¨åŠ ä¸Šä¸€è¡Œã€‚\n\n```Bash\nDOCKER_OPTS=\"--registry-mirror=https://registry.docker-cn.com\"\n```\n\nç„¶åï¼Œé‡å¯ Docker æœåŠ¡ã€‚\n\n```Bash\n$ sudo service docker restart\n```\n\nç°åœ¨å°±ä¼šè‡ªåŠ¨ä»é•œåƒä»“åº“ä¸‹è½½ image æ–‡ä»¶äº†ã€‚\n\n### äºŒã€æ–¹æ³• Aï¼šè‡ªå»º WordPress å®¹å™¨\n\nå‰é¢è¯´è¿‡ï¼Œæœ¬æ–‡ä¼šç”¨ä¸‰ç§æ–¹æ³•æ¼”ç¤º WordPress çš„å®‰è£…ã€‚ç¬¬ä¸€ç§æ–¹æ³•å°±æ˜¯è‡ªå»º WordPress å®¹å™¨ã€‚\n\n#### 2.1 å®˜æ–¹ çš„ PHP image\n\né¦–å…ˆï¼Œæ–°å»ºä¸€ä¸ªå·¥ä½œç›®å½•ï¼Œå¹¶è¿›å…¥è¯¥ç›®å½•ã€‚\n\n```Bash\n$ mkdir docker-demo \u0026\u0026 cd docker-demo\n```\n\nç„¶åï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚\n\n```Bash\ndocker container run \\\n  --rm \\\n  --name wordpress \\\n  --volume \"$PWD/\":/var/www/html \\\n  php:5.6-apache\n```\n\nä¸Šé¢çš„å‘½ä»¤åŸºäº`php`çš„ image æ–‡ä»¶æ–°å»ºä¸€ä¸ªå®¹å™¨ï¼Œå¹¶ä¸”è¿è¡Œè¯¥å®¹å™¨ã€‚`php`çš„æ ‡ç­¾æ˜¯`5.6-apache`ï¼Œè¯´æ˜è£…çš„æ˜¯ PHP 5.6ï¼Œå¹¶ä¸”è‡ªå¸¦ Apache æœåŠ¡å™¨ã€‚è¯¥å‘½ä»¤çš„ä¸‰ä¸ªå‚æ•°å«ä¹‰å¦‚ä¸‹ã€‚\n\n```Bash\n--rmï¼šåœæ­¢è¿è¡Œåï¼Œè‡ªåŠ¨åˆ é™¤å®¹å™¨æ–‡ä»¶ã€‚\n--name wordpressï¼šå®¹å™¨çš„åå­—å«åšwordpressã€‚\n--volume \"$PWD/\":/var/www/htmlï¼šå°†å½“å‰ç›®å½•ï¼ˆ$PWDï¼‰æ˜ å°„åˆ°å®¹å™¨çš„/var/www/htmlï¼ˆApache å¯¹å¤–è®¿é—®çš„é»˜è®¤ç›®å½•ï¼‰ã€‚å› æ­¤ï¼Œå½“å‰ç›®å½•çš„ä»»ä½•ä¿®æ”¹ï¼Œéƒ½ä¼šåæ˜ åˆ°å®¹å™¨é‡Œé¢ï¼Œè¿›è€Œè¢«å¤–éƒ¨è®¿é—®åˆ°ã€‚\n```\n\nè¿è¡Œä¸Šé¢çš„å‘½ä»¤ä»¥åï¼Œå¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œå‘½ä»¤è¡Œä¼šæç¤ºå®¹å™¨å¯¹å¤–çš„ IP åœ°å€ï¼Œè¯·è®°ä¸‹è¿™ä¸ªåœ°å€ï¼Œæˆ‘ä»¬è¦ç”¨å®ƒæ¥è®¿é—®å®¹å™¨ã€‚æˆ‘åˆ†é…åˆ°çš„ IP åœ°å€æ˜¯ 172.17.0.2ã€‚\n\næ‰“å¼€æµè§ˆå™¨ï¼Œè®¿é—® 172.17.0.2ï¼Œä½ ä¼šçœ‹åˆ°ä¸‹é¢çš„æç¤ºã€‚\n\n```Bash\nForbidden\nYou don't have permission to access / on this server.\n```\n\næ˜¯å› ä¸ºå®¹å™¨çš„`/var/www/html`ç›®å½•ï¼ˆä¹Ÿå°±æ˜¯æœ¬æœºçš„`docker-demo`ç›®å½•ï¼‰ä¸‹é¢ä»€ä¹ˆä¹Ÿæ²¡æœ‰ï¼Œæ— æ³•æä¾›å¯ä»¥è®¿é—®çš„å†…å®¹ã€‚\n\nè¯·åœ¨æœ¬æœºçš„`docker-demo`ç›®å½•ä¸‹é¢ï¼Œæ·»åŠ ä¸€ä¸ªæœ€ç®€å•çš„ PHP æ–‡ä»¶`index.php`ã€‚\n\n```Bash\n\u003c?php \nphpinfo();\n?\u003e\n```\n\nä¿å­˜ä»¥åï¼Œæµè§ˆå™¨åˆ·æ–°`172.17.0.2`ï¼Œåº”è¯¥å°±ä¼šçœ‹åˆ°ç†Ÿæ‚‰çš„`phpinfo`é¡µé¢äº†ã€‚\n\n![img](https://j0tzfdufdk.feishu.cn/space/api/box/stream/download/asynccode/?code=MTE1MTExN2M2NjUzYTQzYjIyNmZhMmUxMDRmMGQwYzZfMUdteFNRN2NnaHBERTZVdDQzYVFKbkxKT29QQmZybWtfVG9rZW46Ym94Y25uV2xkc2J6SDJhd0hGaTlhU25BbE5oXzE2NzEwMTE4MDE6MTY3MTAxNTQwMV9WNA)\n\n#### 2.2 æ‹·è´ WordPress å®‰è£…åŒ…\n\næ—¢ç„¶æœ¬åœ°çš„`docker-demo`ç›®å½•å¯ä»¥æ˜ å°„åˆ°å®¹å™¨é‡Œé¢ï¼Œé‚£ä¹ˆæŠŠ WordPress å®‰è£…åŒ…æ‹·è´åˆ°`docker-demo`ç›®å½•ä¸‹ï¼Œä¸å°±å¯ä»¥é€šè¿‡å®¹å™¨è®¿é—®åˆ° WordPress çš„å®‰è£…ç•Œé¢äº†å—ï¼Ÿ\n\né¦–å…ˆï¼Œåœ¨`docker-demo`ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼ŒæŠ“å–å¹¶è§£å‹ WordPress å®‰è£…åŒ…ã€‚\n\n```Bash\nwget https://cn.wordpress.org/wordpress-4.9.4-zh_CN.tar.gz\ntar -xvf wordpress-4.9.4-zh_CN.tar.gz\n```\n\nè§£å‹ä»¥åï¼ŒWordPress çš„å®‰è£…æ–‡ä»¶ä¼šåœ¨`docker-demo/wordpress`ç›®å½•ä¸‹ã€‚\n\nè¿™æ—¶æµè§ˆå™¨è®¿é—®`http://172.17.0.2/wordpress`ï¼Œå°±èƒ½çœ‹åˆ° WordPress çš„å®‰è£…æç¤ºäº†ã€‚\n\n![img](https://j0tzfdufdk.feishu.cn/space/api/box/stream/download/asynccode/?code=MDkxMGFmNzI3MjA2MWIxZmUyNTFjZTAyYWNkMzNkY2RfUlZOM2hEQTFHZkhwTlRHd0QzdGFmQTQxcklIaW9WUmhfVG9rZW46Ym94Y25DcU43NHE5SkM1TEF1UEJ2dE95eWdmXzE2NzEwMTE4MDE6MTY3MTAxNTQwMV9WNA)\n\n#### 2.3 å®˜æ–¹çš„ MySQL å®¹å™¨\n\nWordPress å¿…é¡»æœ‰æ•°æ®åº“æ‰èƒ½å®‰è£…ï¼Œæ‰€ä»¥å¿…é¡»æ–°å»º MySQL å®¹å™¨ã€‚\n\næ‰“å¼€ä¸€ä¸ªæ–°çš„å‘½ä»¤è¡Œçª—å£ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚\n\n```Bash\ndocker container run \\\n  -d \\\n  --rm \\\n  --name wordpressdb \\\n  --env MYSQL_ROOT_PASSWORD=123456 \\\n  --env MYSQL_DATABASE=wordpress \\\n  mysql:5.7\n```\n\nä¸Šé¢çš„å‘½ä»¤ä¼šåŸºäº MySQL çš„ image æ–‡ä»¶ï¼ˆ5.7ç‰ˆæœ¬ï¼‰æ–°å»ºä¸€ä¸ªå®¹å™¨ã€‚è¯¥å‘½ä»¤çš„äº”ä¸ªå‘½ä»¤è¡Œå‚æ•°çš„å«ä¹‰å¦‚ä¸‹ã€‚\n\n\u003e - `-d`ï¼šå®¹å™¨å¯åŠ¨åï¼Œåœ¨åå°è¿è¡Œã€‚\n\u003e\n\u003e - `--rm`ï¼šå®¹å™¨ç»ˆæ­¢è¿è¡Œåï¼Œè‡ªåŠ¨åˆ é™¤å®¹å™¨æ–‡ä»¶ã€‚\n\u003e\n\u003e - `--name wordpressdb`ï¼šå®¹å™¨çš„åå­—å«åš`wordpressdb`\n\u003e\n\u003e - `--env MYSQL_ROOT_PASSWORD=123456`ï¼šå‘å®¹å™¨è¿›ç¨‹ä¼ å…¥ä¸€ä¸ªç¯å¢ƒå˜é‡`MYSQL_ROOT_PASSWORD`ï¼Œè¯¥å˜é‡ä¼šè¢«ç”¨ä½œ MySQL çš„æ ¹å¯†ç ã€‚\n\u003e\n\u003e - `--env MYSQL_DATABASE=wordpress`ï¼šå‘å®¹å™¨è¿›ç¨‹ä¼ å…¥ä¸€ä¸ªç¯å¢ƒå˜é‡`MYSQL_DATABASE`ï¼Œå®¹å™¨é‡Œé¢çš„ MySQL ä¼šæ ¹æ®è¯¥å˜é‡åˆ›å»ºä¸€ä¸ªåŒåæ•°æ®åº“ï¼ˆæœ¬ä¾‹æ˜¯`WordPress`ï¼‰ã€‚\n\nè¿è¡Œä¸Šé¢çš„å‘½ä»¤ä»¥åï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå‘½ä»¤è¡Œä¼šæ˜¾ç¤ºä¸€è¡Œå­—ç¬¦ä¸²ï¼Œè¿™æ˜¯å®¹å™¨çš„ IDï¼Œè¡¨ç¤ºå·²ç»æ–°å»ºæˆåŠŸäº†ã€‚\n\nè¿™æ—¶ï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹æ­£åœ¨è¿è¡Œçš„å®¹å™¨ï¼Œä½ åº”è¯¥çœ‹åˆ°`wordpress`å’Œ`wordpressdb`ä¸¤ä¸ªå®¹å™¨æ­£åœ¨è¿è¡Œã€‚\n\n```Bash\ndocker container ls\nCONTAINER ID   IMAGE            COMMAND                  CREATED          STATUS          PORTS                 NAMES\nf01fe6ff7a31   mysql:5.7        \"docker-entrypoint.sâ€¦\"   15 seconds ago   Up 13 seconds   3306/tcp, 33060/tcp   wordpressdb\nb62e97351f5f   php:5.6-apache   \"docker-php-entrypoiâ€¦\"   32 seconds ago   Up 30 seconds   80/tcp                wordpress\n```\n\nå…¶ä¸­ï¼Œ`wordpressdb`æ˜¯åå°è¿è¡Œçš„ï¼Œå‰å°çœ‹ä¸è§å®ƒçš„è¾“å‡ºï¼Œå¿…é¡»ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥çœ‹ã€‚\n\n```Bash\ndocker container logs wordpressdb\n```\n\n#### 2.4 å®šåˆ¶ PHP å®¹å™¨\n\nç°åœ¨ WordPress å®¹å™¨å’Œ MySQL å®¹å™¨éƒ½å·²ç»æœ‰äº†ã€‚æ¥ä¸‹æ¥ï¼Œè¦æŠŠ WordPress å®¹å™¨è¿æ¥åˆ° MySQL å®¹å™¨äº†ã€‚ä½†æ˜¯ï¼ŒPHP çš„å®˜æ–¹ image ä¸å¸¦æœ‰`mysql`æ‰©å±•ï¼Œå¿…é¡»è‡ªå·±æ–°å»º image æ–‡ä»¶ã€‚\n\né¦–å…ˆï¼Œåœæ‰ WordPress å®¹å™¨ã€‚\n\n```Bash\ndocker container stop wordpress\n\n## åœæ‰ä¹‹å\ndocker container ls              \nCONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                 NAMES\nf01fe6ff7a31   mysql:5.7   \"docker-entrypoint.sâ€¦\"   3 minutes ago   Up 3 minutes   3306/tcp, 33060/tcp   wordpressdb\n```\n\nåœæ‰ä»¥åï¼Œç”±äº`--rm`å‚æ•°çš„ä½œç”¨ï¼Œè¯¥å®¹å™¨æ–‡ä»¶ä¼šè¢«è‡ªåŠ¨åˆ é™¤ã€‚\n\nç„¶åï¼Œåœ¨`docker-demo`ç›®å½•é‡Œé¢ï¼Œæ–°å»ºä¸€ä¸ª`Dockerfile`æ–‡ä»¶ï¼Œå†™å…¥ä¸‹é¢çš„å†…å®¹ã€‚\n\n```Bash\nFROM php:5.6-apache\nRUN docker-php-ext-install mysqli\nCMD apache2-foreground\n```\n\nä¸Šé¢ä»£ç çš„æ„æ€ï¼Œå°±æ˜¯åœ¨åŸæ¥ PHP çš„ image åŸºç¡€ä¸Šï¼Œå®‰è£…`mysqli`çš„æ‰©å±•ã€‚ç„¶åï¼Œå¯åŠ¨ Apacheã€‚\n\nåŸºäºè¿™ä¸ª Dockerfile æ–‡ä»¶ï¼Œæ–°å»ºä¸€ä¸ªåä¸º`phpwithmysql`çš„ image æ–‡ä»¶ã€‚\n\n```Bash\ndocker build -t phpwithmysql .\n```\n\n#### 2.5 Wordpress å®¹å™¨è¿æ¥ MySQL\n\nç°åœ¨åŸºäº phpwithmysql imageï¼Œé‡æ–°æ–°å»ºä¸€ä¸ª WordPress å®¹å™¨ã€‚\n\n```Bash\ndocker container run \\\n  --rm \\\n  --name wordpress \\\n  --volume \"$PWD/\":/var/www/html \\\n  --link wordpressdb:mysql \\\n  phpwithmysql\n```\n\nè·Ÿä¸Šä¸€æ¬¡ç›¸æ¯”ï¼Œä¸Šé¢çš„å‘½ä»¤å¤šäº†ä¸€ä¸ªå‚æ•°`--link wordpressdb:mysql`ï¼Œè¡¨ç¤º WordPress å®¹å™¨è¦è¿åˆ°`wordpressdb`å®¹å™¨ï¼Œå†’å·è¡¨ç¤ºè¯¥å®¹å™¨çš„åˆ«åæ˜¯`mysql`ã€‚\n\nè¿™æ—¶è¿˜è¦æ”¹ä¸€ä¸‹`wordpress`ç›®å½•çš„æƒé™ï¼Œè®©å®¹å™¨å¯ä»¥å°†é…ç½®ä¿¡æ¯å†™å…¥è¿™ä¸ªç›®å½•ï¼ˆå®¹å™¨å†…éƒ¨å†™å…¥çš„`/var/www/html`ç›®å½•ï¼Œä¼šæ˜ å°„åˆ°è¿™ä¸ªç›®å½•ï¼‰ã€‚\n\n```Bash\nchmod -R 777 wordpress\n```\n\næ¥ç€ï¼Œå›åˆ°æµè§ˆå™¨çš„`http://172.17.0.2/wordpress`é¡µé¢ï¼Œç‚¹å‡»\"ç°åœ¨å°±å¼€å§‹ï¼\"æŒ‰é’®ï¼Œå¼€å§‹å®‰è£…ã€‚\n\nWordPress æç¤ºè¦è¾“å…¥æ•°æ®åº“å‚æ•°ã€‚è¾“å…¥çš„å‚æ•°å¦‚ä¸‹ã€‚\n\n![img](https://j0tzfdufdk.feishu.cn/space/api/box/stream/download/asynccode/?code=MzEyYjA2NmVmMDE0NWU3N2ExZGU2ZjAyZWFmYTlhODVfd29RTHdycHluMURNUG9XZlZxS2FKTld4Nk1iZXk4a1dfVG9rZW46Ym94Y254YWVpSmRCM21qUElZZ0RIWmRpODVkXzE2NzEwMTE4MDE6MTY3MTAxNTQwMV9WNA)\n\n\u003e - æ•°æ®åº“åï¼š`wordpress`\n\u003e\n\u003e - ç”¨æˆ·åï¼š`root`\n\u003e\n\u003e - å¯†ç ï¼š`123456`\n\u003e\n\u003e - æ•°æ®åº“ä¸»æœºï¼š`mysql`\n\u003e\n\u003e - è¡¨å‰ç¼€ï¼š`wp_`ï¼ˆä¸å˜ï¼‰\n\nç‚¹å‡»\"ä¸‹ä¸€æ­¥\"æŒ‰é’®ï¼Œå¦‚æœ Wordpress è¿æ¥æ•°æ®åº“æˆåŠŸï¼Œå°±ä¼šå‡ºç°ä¸‹é¢çš„é¡µé¢ï¼Œè¿™å°±è¡¨ç¤ºå¯ä»¥å®‰è£…äº†ã€‚\n\n![img](https://j0tzfdufdk.feishu.cn/space/api/box/stream/download/asynccode/?code=MDFjODhjOWEzZGJhNTc0MWJjMTI2ZmE1ZWM4ZTVlYTlfRnpyN2xadDJZMzJiSWszMlhWVk00NjV5dzZJYm1ZZjBfVG9rZW46Ym94Y25wbk1oZ3NieVNWVDlucWxHWFJRbGVlXzE2NzEwMTE4MDE6MTY3MTAxNTQwMV9WNA)\n\nè‡³æ­¤ï¼Œè‡ªå»º WordPress å®¹å™¨çš„æ¼”ç¤ºå®Œæ¯•ï¼Œå¯ä»¥æŠŠæ­£åœ¨è¿è¡Œçš„ä¸¤ä¸ªå®¹å™¨å…³é—­äº†ï¼ˆå®¹å™¨æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ é™¤ï¼‰ã€‚\n\n![img](https://j0tzfdufdk.feishu.cn/space/api/box/stream/download/asynccode/?code=NTk1ZTQ1MDhiOTI4MTE1MzIzZjZlMTI3ODJjODAyZWVfSmRHcWdKc09oRDJXMElHZ0N1WWU5YzhKNk05STN4ODFfVG9rZW46Ym94Y255T2lCVWpmd2NOaFppQUlxZEtUYk5oXzE2NzEwMTE4MDE6MTY3MTAxNTQwMV9WNA)\n\nå®‰è£…ä¹‹å\n\n![img](https://j0tzfdufdk.feishu.cn/space/api/box/stream/download/asynccode/?code=MzkwYTg5NzQwMzJlYzAyZTNlNWI0MGI2MDBiYWZhZDZfWUdBd1VrV2tXNk4xc0RRNU5WeVB2M2hNbXJEYnJZcG1fVG9rZW46Ym94Y25tUExQRGUxMnp0dkI0WXhsbXJ6bU9oXzE2NzEwMTE4MDE6MTY3MTAxNTQwMV9WNA)\n\n```Bash\ndocker container stop wordpress wordpressdb\n\n## ä¹‹å\ndocker container ls\nCONTAINER ID   IMAGE     COMMAND   CREATED   STATUS    PORTS     NAMES\n```\n\n### ä¸‰ã€æ–¹æ³• Bï¼šWordpress å®˜æ–¹é•œåƒ\n\nä¸Šä¸€éƒ¨åˆ†çš„è‡ªå»º WordPress å®¹å™¨ï¼Œè¿˜æ˜¯æŒºéº»çƒ¦çš„ã€‚å…¶å®ä¸ç”¨è¿™ä¹ˆéº»çƒ¦ï¼ŒDocker å·²ç»æä¾›äº†å®˜æ–¹ [WordPress](https://hub.docker.com/_/wordpress/) imageï¼Œç›´æ¥ç”¨é‚£ä¸ªå°±å¯ä»¥äº†ã€‚æœ‰äº†ä¸Šä¸€éƒ¨åˆ†çš„åŸºç¡€ï¼Œä¸‹é¢çš„æ“ä½œå°±å¾ˆå®¹æ˜“ç†è§£äº†ã€‚\n\n \n\n#### 3.1 åŸºæœ¬ç”¨æ³•\n\né¦–å…ˆï¼Œæ–°å»ºå¹¶å¯åŠ¨ MySQL å®¹å™¨ã€‚\n\n```Bash\ndocker container run \\\n  -d \\\n  --rm \\\n  --name wordpressdb \\\n  --env MYSQL_ROOT_PASSWORD=123456 \\\n  --env MYSQL_DATABASE=wordpress \\\n  mysql:5.7\n```\n\nç„¶åï¼ŒåŸºäºå®˜æ–¹çš„ WordPress imageï¼Œæ–°å»ºå¹¶å¯åŠ¨ WordPress å®¹å™¨ã€‚\n\n```Bash\ndocker container run \\\n  -d \\\n  --rm \\\n  --name wordpress \\\n  --env WORDPRESS_DB_PASSWORD=123456 \\\n  --env WORDPRESS_DB_USER=root \\\n  --link wordpressdb:mysql \\\n  wordpress\n```\n\nä¸Šé¢å‘½ä»¤ä¸­ï¼Œå„ä¸ªå‚æ•°çš„å«ä¹‰å‰é¢éƒ½è§£é‡Šè¿‡äº†ï¼Œå…¶ä¸­ç¯å¢ƒå˜é‡`WORDPRESS_DB_PASSWORD`æ˜¯ MySQL å®¹å™¨çš„æ ¹å¯†ç ã€‚\n\n```Bash\ndocker container ls   \nCONTAINER ID   IMAGE       COMMAND                  CREATED          STATUS          PORTS                 NAMES\nad6ee2dd4971   wordpress   \"docker-entrypoint.sâ€¦\"   48 seconds ago   Up 35 seconds   80/tcp                wordpress\n87f2d581abda   mysql:5.7   \"docker-entrypoint.sâ€¦\"   3 minutes ago    Up 3 minutes    3306/tcp, 33060/tcp   wordpressdb\n```\n\nä¸Šé¢å‘½ä»¤æŒ‡å®š`wordpress`å®¹å™¨åœ¨åå°è¿è¡Œï¼Œå¯¼è‡´å‰å°çœ‹ä¸è§è¾“å‡ºï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æŸ¥å‡º`wordpress`å®¹å™¨çš„ IP åœ°å€ã€‚\n\n```Bash\ndocker container inspect wordpress\n[\n    {\n        \"Id\": \"ad6ee2dd497184a397c8bd58df7b415b5081bff5b0e000a10daa0b970b38cf9c\",\n        \"Created\": \"2022-08-26T02:16:36.222826772Z\",\n        \"Path\": \"docker-entrypoint.sh\",\n        \"Args\": [\n            \"apache2-foreground\"\n        ],\n   ã€‚ã€‚ã€‚\n            \"GlobalIPv6PrefixLen\": 0,\n            \"IPAddress\": \"172.17.0.3\",\n            \"IPPrefixLen\": 16,\n            \"IPv6Gateway\": \"\",\n   ã€‚ã€‚ã€‚\n    }\n]\n```\n\nä¸Šé¢å‘½ä»¤è¿è¡Œä»¥åï¼Œä¼šè¾“å‡ºå¾ˆå¤šå†…å®¹ï¼Œæ‰¾åˆ°`IPAddress`å­—æ®µå³å¯ã€‚æˆ‘çš„æœºå™¨è¿”å›çš„ IP åœ°å€æ˜¯`172.17.0.3`ã€‚\n\næµè§ˆå™¨è®¿é—®`172.17.0.3`ï¼Œå°±ä¼šçœ‹åˆ° WordPress çš„å®‰è£…æç¤ºã€‚\n\n![img](https://j0tzfdufdk.feishu.cn/space/api/box/stream/download/asynccode/?code=NjM4MmQ0MzQ2OGU1NTgzM2ZmM2NkNmJkMzY2M2QyMzdfVVY4dUdnQ1F0ZWM5OW1GaGFZVTFGZ0ZyUkVZRGY0aW5fVG9rZW46Ym94Y25kSURBVXN5NUdndWFBTjlDUTFrdGdkXzE2NzEwMTE4MDE6MTY3MTAxNTQwMV9WNA)\n\n#### 3.2 WordPress å®¹å™¨çš„å®šåˆ¶\n\nåˆ°äº†ä¸Šä¸€æ­¥ï¼Œå®˜æ–¹ WordPress å®¹å™¨çš„å®‰è£…å°±å·²ç»æˆåŠŸäº†ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ³•æœ‰ä¸¤ä¸ªå¾ˆä¸æ–¹ä¾¿çš„åœ°æ–¹ã€‚\n\n\u003e - æ¯æ¬¡æ–°å»ºå®¹å™¨ï¼Œè¿”å›çš„ IP åœ°å€ä¸èƒ½ä¿è¯ç›¸åŒï¼Œå¯¼è‡´è¦æ›´æ¢ IP åœ°å€è®¿é—® WordPressã€‚\n\u003e\n\u003e - WordPress å®‰è£…åœ¨å®¹å™¨é‡Œé¢ï¼Œæœ¬åœ°æ— æ³•ä¿®æ”¹æ–‡ä»¶ã€‚\n\nè§£å†³è¿™ä¸¤ä¸ªé—®é¢˜å¾ˆå®¹æ˜“ï¼Œåªè¦æ–°å»ºå®¹å™¨çš„æ—¶å€™ï¼ŒåŠ ä¸¤ä¸ªå‘½ä»¤è¡Œå‚æ•°å°±å¯ä»¥äº†ã€‚\n\nå…ˆæŠŠåˆšæ‰å¯åŠ¨çš„ WordPress å®¹å™¨ç»ˆæ­¢ï¼ˆå®¹å™¨æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ é™¤ï¼‰ã€‚\n\n```Bash\ndocker container stop wordpress\n```\n\nç„¶åï¼Œä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤æ–°å»ºå¹¶å¯åŠ¨ WordPress å®¹å™¨ã€‚\n\n```Bash\ndocker container run \\\n  -d \\\n  -p 127.0.0.2:8080:80 \\\n  --rm \\\n  --name wordpress \\\n  --env WORDPRESS_DB_PASSWORD=123456 \\\n  --env WORDPRESS_DB_USER=root \\\n  --link wordpressdb:mysql \\\n  --volume \"$PWD/wordpress\":/var/www/html \\\n  wordpress\n```\n\nä¸Šé¢çš„å‘½ä»¤è·Ÿå‰é¢ç›¸æ¯”ï¼Œå‘½ä»¤è¡Œå‚æ•°åªå¤šå‡ºäº†ä¸¤ä¸ªã€‚\n\n\u003e - `-p 127.0.0.2:8080:80`ï¼šå°†å®¹å™¨çš„ 80 ç«¯å£æ˜ å°„åˆ°`127.0.0.2`çš„`8080`ç«¯å£ã€‚\n\u003e\n\u003e - `--volume \"$PWD/wordpress\":/var/www/html`ï¼šå°†å®¹å™¨çš„`/var/www/html`ç›®å½•æ˜ å°„åˆ°å½“å‰ç›®å½•çš„`wordpress`å­ç›®å½•ã€‚\n\næµè§ˆå™¨è®¿é—®`127.0.0.2:8080`å°±èƒ½çœ‹åˆ° WordPress çš„å®‰è£…æç¤ºäº†ã€‚è€Œä¸”ï¼Œä½ åœ¨`wordpress`å­ç›®å½•ä¸‹çš„æ¯æ¬¡ä¿®æ”¹ï¼Œéƒ½ä¼šåæ˜ åˆ°å®¹å™¨é‡Œé¢ã€‚\n\n![img](https://j0tzfdufdk.feishu.cn/space/api/box/stream/download/asynccode/?code=NTY2NGJjYjUxM2ViNjM0YjEzNTQ3MzQ0YWJlMmVlMmJfVm9nVzRRVkRVcmtUcDJUQzBmVDR2OVhTNnJxeVdYY2VfVG9rZW46Ym94Y25lYzlUMW1meUlLNXdEWGREVFZIUmJnXzE2NzEwMTE4MDE6MTY3MTAxNTQwMV9WNA)\n\næœ€åï¼Œç»ˆæ­¢è¿™ä¸¤ä¸ªå®¹å™¨ï¼ˆå®¹å™¨æ–‡ä»¶ä¼šè‡ªåŠ¨åˆ é™¤ï¼‰ã€‚\n\n```Bash\ndocker container stop wordpress wordpressdb\n```\n\n### å››ã€æ–¹æ³• Cï¼šDocker Compose å·¥å…·\n\nä¸Šé¢çš„æ–¹æ³• B å·²ç»æŒºç®€å•äº†ï¼Œä½†æ˜¯å¿…é¡»è‡ªå·±åˆ†åˆ«å¯åŠ¨ä¸¤ä¸ªå®¹å™¨ï¼Œå¯åŠ¨çš„æ—¶å€™ï¼Œè¿˜è¦åœ¨å‘½ä»¤è¡Œæä¾›å®¹å™¨ä¹‹é—´çš„è¿æ¥ä¿¡æ¯ã€‚å› æ­¤ï¼ŒDocker æä¾›äº†ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•ï¼Œæ¥ç®¡ç†å¤šä¸ªå®¹å™¨çš„è”åŠ¨ã€‚\n\n#### 4.1 Docker Compose ç®€ä»‹\n\n \n\n![img](https://j0tzfdufdk.feishu.cn/space/api/box/stream/download/asynccode/?code=MGZjZTA4YTllOTk0MDZlYjY3ZDI1NzUyZDUyNmU1MTlfU3pPR0Y0ZjlCQjBMWjZXMW9uQ0FvUFlzdmFuM2xLZVpfVG9rZW46Ym94Y25Nbk9lYm55UUNPaUc1bnpoRjA5QktRXzE2NzEwMTE4MDE6MTY3MTAxNTQwMV9WNA)\n\n[Compose](https://docs.docker.com/compose/) æ˜¯ Docker å…¬å¸æ¨å‡ºçš„ä¸€ä¸ªå·¥å…·è½¯ä»¶ï¼Œå¯ä»¥ç®¡ç†å¤šä¸ª Docker å®¹å™¨ç»„æˆä¸€ä¸ªåº”ç”¨ã€‚ä½ éœ€è¦å®šä¹‰ä¸€ä¸ª [YAML](https://www.ruanyifeng.com/blog/2016/07/yaml.html) æ ¼å¼çš„é…ç½®æ–‡ä»¶`docker-compose.yml`ï¼Œå†™å¥½å¤šä¸ªå®¹å™¨ä¹‹é—´çš„è°ƒç”¨å…³ç³»ã€‚ç„¶åï¼Œåªè¦ä¸€ä¸ªå‘½ä»¤ï¼Œå°±èƒ½åŒæ—¶å¯åŠ¨/å…³é—­è¿™äº›å®¹å™¨ã€‚\n\n```Bash\n# å¯åŠ¨æ‰€æœ‰æœåŠ¡\ndocker compose up\n# å…³é—­æ‰€æœ‰æœåŠ¡\ndocker compose stop\n```\n\n#### 4.2 Docker Compose çš„å®‰è£…\n\nMac å’Œ Windows åœ¨å®‰è£… docker çš„æ—¶å€™ï¼Œä¼šä¸€èµ·å®‰è£… docker composeã€‚Linux ç³»ç»Ÿä¸‹çš„å®‰è£…å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://docs.docker.com/compose/install/#install-compose)ã€‚\n\nå®‰è£…å®Œæˆåï¼Œè¿è¡Œä¸‹é¢çš„å‘½ä»¤ã€‚\n\n```Bash\ndocker compose version\nDocker Compose version v2.6.0\n```\n\n#### 4.3 WordPress ç¤ºä¾‹\n\nåœ¨`docker-demo`ç›®å½•ä¸‹ï¼Œæ–°å»º`docker-compose.yml`æ–‡ä»¶ï¼Œå†™å…¥ä¸‹é¢çš„å†…å®¹ã€‚\n\n```Bash\nversion: \"3\"\n\nservices:\n  mysql:\n    image: mysql:5.7\n    environment:\n     - MYSQL_ROOT_PASSWORD=123456\n     - MYSQL_DATABASE=wordpress\n  web:\n    image: wordpress\n    links:\n     - mysql\n    environment:\n     - WORDPRESS_DB_PASSWORD=123456\n     - WORDPRESS_DB_USER=root\n    ports:\n     - \"127.0.0.3:8080:80\"\n    working_dir: /var/www/html\n```\n\nä¸Šé¢ä»£ç ä¸­ï¼Œä¸¤ä¸ªé¡¶å±‚æ ‡ç­¾è¡¨ç¤ºæœ‰ä¸¤ä¸ªå®¹å™¨`mysql`å’Œ`web`ã€‚æ¯ä¸ªå®¹å™¨çš„å…·ä½“è®¾ç½®ï¼Œå‰é¢éƒ½å·²ç»è®²è§£è¿‡äº†ï¼Œè¿˜æ˜¯æŒºå®¹æ˜“ç†è§£çš„ã€‚\n\nå¯åŠ¨ä¸¤ä¸ªå®¹å™¨ã€‚ \n\n```Bash\ndocker compose up\n```\n\næµè§ˆå™¨è®¿é—® http://127.0.0.3:8080ï¼Œåº”è¯¥å°±èƒ½çœ‹åˆ° WordPress çš„å®‰è£…ç•Œé¢ã€‚\n\n![img](https://j0tzfdufdk.feishu.cn/space/api/box/stream/download/asynccode/?code=YTYyMWNjMTE5ZDJiN2E3NmM2ZjQ5ZTkzZjk5NTZlZjlfQnEwYXgxZlRYTVBmeU5hU2RFaGRoNm9jekdCZmtldzFfVG9rZW46Ym94Y25tUkxqcm04YlRoZzI5Z3BRWHRwUFdlXzE2NzEwMTE4MDE6MTY3MTAxNTQwMV9WNA)\n\nç°åœ¨å…³é—­ä¸¤ä¸ªå®¹å™¨ã€‚\n\n```Bash\ndocker compose stop\n```\n\nå…³é—­ä»¥åï¼Œè¿™ä¸¤ä¸ªå®¹å™¨æ–‡ä»¶è¿˜æ˜¯å­˜åœ¨çš„ï¼Œå†™åœ¨é‡Œé¢çš„æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚ä¸‹æ¬¡å¯åŠ¨çš„æ—¶å€™ï¼Œè¿˜å¯ä»¥å¤ç”¨ã€‚ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŠŠè¿™ä¸¤ä¸ªå®¹å™¨æ–‡ä»¶åˆ é™¤ï¼ˆå®¹å™¨å¿…é¡»å·²ç»åœæ­¢è¿è¡Œï¼‰ã€‚\n\n```Bash\ndocker compose rm\n```\n\n### äº”ã€å‚è€ƒé“¾æ¥\n\n- [How to Manually Build Docker Containers for WordPress](https://www.sitepoint.com/how-to-manually-build-docker-containers-for-wordpress/), by Aleksander Koko\n\n- [How to Use the Official Docker WordPress Image](https://www.sitepoint.com/how-to-use-the-official-docker-wordpress-image/), by Aleksander Koko\n\n- [Deploying WordPress with Docker](https://www.sitepoint.com/deploying-wordpress-with-docker/), by Aleksander Koko\n\n","lastmodified":"2022-12-14T10:05:00.50340721Z","tags":null},"/notes/hands-on-flask":{"title":"Hands on Flask","content":"\n# Hands on Flask: step by step\n\n\u003e I am a newcomer of Flask. So I follow the official tutorial to build a blog post web application step by step.\n\n\n\n## Reference\n\n[Flask Installation](https://flask.palletsprojects.com/en/2.2.x/installation/)\n\n[Flask Tutorial](https://flask.palletsprojects.com/en/2.2.x/tutorial/)\n\nFollow the tutorial to build a blog web app like:\n\n\n\n![image-20221201145000837](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221201145000837.png)\n\n\n\n## Step by Step\n\n### Step 0.Backgroud\n\nbuild a basic blog application called Flaskr using Flask.\n\n\n\n### Step 1. Project Layout\n\n#### Create a project directory\n\n```shell\nmkdir flask-tutorial\ncd flask-tutorial/\n```\n\n\n\n#### Install Flask\n\n[Flask Installation Doc ](https://flask.palletsprojects.com/en/2.2.x/installation/)\n\nCreate an python environment using [venv](https://docs.python.org/3/library/venv.html#module-venv):\n\n```shell\n$ python3 -m venv venv\n\n$ tree . -L 3\n.\nâ””â”€â”€ venv\n    â”œâ”€â”€ bin\n    â”‚Â Â  â”œâ”€â”€ Activate.ps1\n    â”‚Â Â  â”œâ”€â”€ activate\n    â”‚Â Â  â”œâ”€â”€ activate.csh\n    â”‚Â Â  â”œâ”€â”€ activate.fish\n    â”‚Â Â  â”œâ”€â”€ pip\n    â”‚Â Â  â”œâ”€â”€ pip3\n    â”‚Â Â  â”œâ”€â”€ pip3.9\n    â”‚Â Â  â”œâ”€â”€ python -\u003e python3\n    â”‚Â Â  â”œâ”€â”€ python3 -\u003e /Users/yangls06/opt/miniconda3/bin/python3\n    â”‚Â Â  â””â”€â”€ python3.9 -\u003e python3\n    â”œâ”€â”€ include\n    â”œâ”€â”€ lib\n    â”‚Â Â  â””â”€â”€ python3.9\n    â””â”€â”€ pyvenv.cfg\n\n5 directories, 11 files\n\n$ tree venv/lib/python3.9/ -L 3\nvenv/lib/python3.9/\nâ””â”€â”€ site-packages\n    â”œâ”€â”€ _distutils_hack\n    â”‚Â Â  â”œâ”€â”€ __init__.py\n    â”‚Â Â  â”œâ”€â”€ __pycache__\n    â”‚Â Â  â””â”€â”€ override.py\n    â”œâ”€â”€ distutils-precedence.pth\n    â”œâ”€â”€ pip\n    â”‚Â Â  â”œâ”€â”€ __init__.py\n    â”‚Â Â  â”œâ”€â”€ __main__.py\n        ...\n    â”œâ”€â”€ pkg_resources\n    ...\n```\n\n\n\nActivate the environment\n\n```shell\n$ . venv/bin/activate\n```\n\nThen the environment has been changed.\n\n![image-20221201153333547](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221201153333547.png)\n\nInstall Flask\n\nWithin the activated environment, install Flask using `pip`:\n\n```shell\n$ pip install Flask\n\nLooking in indexes: https://pypi.douban.com/simple\nCollecting Flask\n  Downloading https://pypi.doubanio.com/packages/0f/43/15f4f9ab225b0b25352412e8daa3d0e3d135fcf5e127070c74c3632c8b4c/Flask-2.2.2-py3-none-any.whl (101 kB)\n     â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” 101.5/101.5 KB 1.8 MB/s eta 0:00:00\n...\nCollecting MarkupSafe\u003e=2.0\n  Downloading https://pypi.doubanio.com/packages/06/7f/d5e46d7464360b6ac39c5b0b604770dba937e3d7cab485d2f3298454717b/MarkupSafe-2.1.1-cp39-cp39-macosx_10_9_universal2.whl (17 kB)\nInstalling collected packages: zipp, MarkupSafe, itsdangerous, click, Werkzeug, Jinja2, importlib-metadata, Flask\nSuccessfully installed Flask-2.2.2 Jinja2-3.1.2 MarkupSafe-2.1.1 Werkzeug-2.2.2 click-8.1.3 importlib-metadata-5.1.0 itsdangerous-2.1.2 zipp-3.11.0\n```\n\n\n\nGit init\n\n```shell\n$ git init\n```\n\n\n\nwith `.gitignore`\n\n```\nvenv/\n\n*.pyc\n__pycache__/\n\ninstance/\n\n.pytest_cache/\n.coverage\nhtmlcov/\n\ndist/\nbuild/\n*.egg-info/\n```\n\n\n\nAdd folders\n\n```shell\n$ tree -a -L 1\n.\nâ”œâ”€â”€ .git\nâ”œâ”€â”€ .gitignore\nâ”œâ”€â”€ flaskr\nâ”œâ”€â”€ tests\nâ””â”€â”€ venv\n\n4 directories, 1 file\n```\n\n\n\n### Step 3. Application Setup\n\n#### The Application Factory: \\__init__.py\n\n* create `Flask` instance \n* make `flaskr` directory a package\n\n```python\n#!/usr/bin/env python\n# -*- encoding: utf-8 -*-\n\n\"\"\"\n@Time    :   2022/12/01 15:58:24\n@Author  :   Linsan Yang \n@Desc    :   init flaskr\n\"\"\"\n\nimport os\nfrom flask import Flask\n\ndef create_app(test_config=None):\n    # create and configure the app\n    app = Flask(__name__, instance_relative_config=True)\n    app.config.from_mapping(\n        SECRET_KEY = 'dev',\n        DATABASE=os.path.join(app.instance_path, 'flaskr.sqlite'),\n    )\n\n    if test_config is None:\n        # load the instance config, if it exists, when not testing\n        app.config.from_pyfile('config.py', silent=True)\n    else:\n        # load the test config if passed in\n        app.config.from_mapping(test_config)\n    \n    # ensure the instance folder exists\n    try:\n        os.makedirs(app.instance_path)\n    except OSError as e:\n        pass\n\n    # a simple page that says hello\n    @app.route('/hello')\n    def hello():\n        return 'Hello, World!'\n\n    return app\n\n```\n\n\n\n**instance folder** \n\nThere will be a `instance/`directory, located outside the `flaskr` package and can hold local data that shouldnâ€™t be committed to version control, such as configuration secrets and the database file.\n\n\n\n**test_config**\n\nUsing test_config for testing.\n\n\n\n**@app.route()**\n\ncreate a simple route of `/hello`\n\n\n\n#### Run The Application\n\nIn the `flask-tutorial` dir not `flaskr` package:\n\n```shell\n$ flask --app flaskr --debug run\n * Serving Flask app 'flaskr'\n * Debug mode: on\nWARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.\n * Running on http://127.0.0.1:5000\nPress CTRL+C to quit\n * Restarting with stat\n * Debugger is active!\n * Debugger PIN: 134-914-837\n```\n\nThen open 127.0.0.1:5000/hello in browser, got\n\n![image-20221201162507048](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221201162507048.png)\n\n### Step 4. Define and Access the Database\n\nThe app will use `Sqlite` database to store users and posts. Python has a built-in module `sqlite3` module.\n\n#### Connect to Sqlite\n\nflaskr/db.py\n\n```python\nimport sqlite3\n\nimport click\nfrom flask import current_app, g\n\ndef get_db():\n    if 'db' not in g:\n        g.db = sqlite3.connect(\n            current_app.config['DATABASE'],\n            detect_types=sqlite3.PARSE_DECLTYPES\n        )\n        g.db.row_factory = sqlite3.Row\n    return g.db\n\ndef close_db(e=None):\n    db = g.pop('db', None)\n\n    if db is not None:\n        db.close()\n```\n\n\n\n`g` is a spectial object for each request to share data among different functions. `current_app` is similar.\n\n\n\n#### Create Tables: using sql\n\nDefine `user` and `post` table in `flaskr/schema.sql`:\n\n```sql\nDROP TABLE IF EXISTS user;\nDROP TABLE IF EXISTS post;\n\nCREATE TABLE user (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  username TEXT UNIQUE NOT NULL,\n  password TEXT NOT NULL\n);\n\nCREATE TABLE post (\n  id INTEGER PRIMARY KEY AUTOINCREMENT,\n  author_id INTEGER NOT NULL,\n  created TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,\n  title TEXT NOT NULL,\n  body TEXT NOT NULL,\n  FOREIGN KEY (author_id) REFERENCES user (id)\n);\n```\n\n\n\nAdd functions to run the SQLs to the `db.py`\n\n```python\ndef init_db():\n    db = get_db()\n    \n    with current_app.open_resource('schema.sql') as f:\n        db.executescript(f.read().decode('utf8'))\n\n@click.command('init-db')\ndef init_db_command():\n    '''Clear the existing data and create new tables.'''\n    init_db()\n    click.echo('Initialized the database.')\n```\n\n\n\n#### Register with the Applicaiton\n\nThe close_db and init_db_command functions need to be registered with the app instance for use.\n\nIn `db.py` add a new `init_app` function:\n\n```python\ndef init_app(app):\n    # tells Flask to call that function when cleaning up after returning the response\n    app.teardown_appcontext(close_db)\n    # adds a new command that can be called with the flask command\n    app.cli.add_command(init_db_command)\n```\n\n\n\nThen import and call this function from the factory in `__init__.py`.\n\n```python\ndef create_app(test_config=None):\n    # create and configure the app\n    app = ...\n    # existing code omitted\n    \n    # add db functions\n    from . import db\n    db.init_app(app)\n\n    return app\n\n```\n\n\n\n#### Initialize the Database\n\nNow use `init-db`command like this:\n\n```shell\n$ flask --app flaskr init-db\nInitialized the database.\n\n$ tree instance/\ninstance/\nâ””â”€â”€ flaskr.sqlite\n\n0 directories, 1 file\n```\n\n\n\nThe command generates a sqlite db file `flaskr.sqlite` in `instance/` dir. \n\n\n\n### Step 5. Blueprints and Views\n\nReferances:\n\n[Blueprints and Views](https://flask.palletsprojects.com/en/2.2.x/tutorial/views/)\n\n[Use a Flask Blueprint to Architect Your Applications](https://realpython.com/flask-blueprint/#:~:text=Flask%20is%20a%20very%20popular,its%20functionality%20into%20reusable%20components)\n\n\n\nConcept: view\n\nA view is Flask's respond to the outgoing request. Flask uses patterns to match the incoming request URL to the view that should handle it.\n\n\n\nConcept: blueprint\n\nA blueprint is a way to organize a group of related views and other code. Rather than registering views and other code directly with an application, they are registered with a blueprint. Then the blueprint is registered with the application when it is available in the factory function.\n\n\n\n#### Create a Blueprint\n\nFlaskr will have two blueprints:\n\n* auth functions\n* blog posts functions\n\n\n\n`Flaskr/auth.py`\n\n```python\nimport functools\n\nfrom flask import (\n    Blueprint, flash, g, redirect, render_template, request, session, url_for\n)\nfrom werkzeug.security import check_password_hash, generate_password_hash\nfrom flaskr.db import get_db\n\nbp = Blueprint('auth', __name__, url_prefix='/auth')\n\n```\n\nA new `Blueprint` is created:\n\n* with `name`: 'auth'\n* with `import_name`: '\\__name__', helping the blueprint to know where itâ€™s defined\n* with `url_prefix`: will be prepended (added at head)to all the URLs associated with this blueprint.\n\nThen register the blueprint to the app from the factory in the `__init__.py`\n\n```python\ndef create_app(test_config=None):\n    # create and configure the app\n    app = ...\n    # existing code omitted\n    \n\n    # add auth blueprint\n    from . import auth\n    app.register_blueprint(auth.bp)\n\n    return app\n```\n\n\n\n\u003e Referances:\n\u003e\n\u003e [Python functools](https://docs.python.org/3/library/functools.html)\n\n\n\n#### Register view\n\nWhen the user visits the `/auth/register` URL, the `register` view will return [HTML](https://developer.mozilla.org/docs/Web/HTML) with a form for them to fill out. When they submit the form, it will validate their input and either show the form again with an error message or create the new user and go to the login page.\n\n\n\nThe view code is as following in `flaskr/auth.py`\n\n```python\n@bp.route('/register', methods=('GET', 'POST'))\ndef register():\n    if request.method == 'POST':\n        username = request.form['username']\n        password = request.form['password']\n        db = get_db()\n        error = None\n\n        if not username:\n            error = 'Username is required.'\n        elif not password:\n            error = 'Password is required.'\n\n        if error is None:\n            try:\n                db.execute(\n                    'INSERT INTO user (username, password) VALUES (?, ?)',\n                    (username, generate_password_hash(password))\n                )\n                db.commit()\n            except db.IntegrityError:\n                error = f\"User {username} is already registered.\"\n            else:\n                return redirect(url_for('auth.login'))\n        \n        flash(error)\n    \n    return render_template('auth/register.html')\n```\n\n\n\nThe `register` view works as following:\n\n* @bp.route associates the URL `/register` with the `register` view.\n* If the user submited the register form, `request.method == 'POST'`, then validate the input `username` and `password` and store them into the database.\n* If storing the user info succeeds, then redirect to the `auth.login` page.\n* If the user is initially landing on the `register` page, or there was a validation error, the `register.html` will be shown.\n\n\n\n#### Login view\n\nThis view follows the same pattern as `register` view.\n\n```python\n @bp.route('/login', methods=('GET', 'POST'))\ndef login():\n    if request.method == 'POST':\n        username = request.form['username']\n        password = request.form['password']\n        db = get_db()\n        error = None\n\n        user = db.execute(\n            'SELECT * FROM user WHERE username = ?', (username,)\n        ).fetchone()\n\n        if user is None:\n            error = 'Incorrect username.'\n        elif not check_password_hash(user['password'], password):\n            error = 'Incorrect password.'\n        \n        if error is None:\n            session.clear()\n            session['user_id'] = user['id']\n            return redirect(url_for('index'))\n        \n        flash(error)\n    \n    return render_template('auth/login.html')\n\n```\n\nTips:\n\n* The user info is queried and stored in `user` variable using `fetch_one` function.\n* Validate the `username` and `password` (by `check_password_hash`) inputs.\n* The `session` (a dict storing data across requests) refreshes if login succeeds. (The data is stored in a *cookie* that is sent to the browser, and the browser then sends it back with subsequent requests.)\n\n\n\nWe can get user info at the beginning of each request via `session`:\n\n```python\n@bp.before_app_request\ndef load_logged_in_user():\n    user_id = session.get('user_id')\n\n    if user_id is None:\n        g.user = None\n    else:\n        g.user = get_db().execute(\n            'SELECT * FROM user WHERE id = ?', (user_id,)\n        ).fetchone()\n```\n\nTips:\n\n* [`bp.before_app_request()`](https://flask.palletsprojects.com/en/2.2.x/api/#flask.Blueprint.before_app_request) registers a function that runs before the view function, no matter what URL is requested. \n* `load_logged_in_user`  gets that user info from the database via `session` and stores it on [`g.user`](https://flask.palletsprojects.com/en/2.2.x/api/#flask.g), which lasts for the length of the request. \n\n\n\n#### Logout view\n\nThe Logout view removes the user id from the [`session`](https://flask.palletsprojects.com/en/2.2.x/api/#flask.session). \n\n```python\n@bp.route('/logout')\ndef logout():\n    session.clear()\n    return redirect(url_for('index'))\n```\n\n\n\n#### Require Auth in Other views\n\nCreating, editing and deleting blog posts requires the user to be logged in. Use a **decorator** to achieve this.\n\n```python\ndef login_required(view):\n    @functools.wraps(view)\n    def wrapped_view(**kwargs):\n        if g.user is None:\n            return redirect(url_for('auth.login'))\n        \n        return view(**kwargs)\n    \n    return wrapped_view \n```\n\nThis decorator wraps the view in this way: if a user is not logged in, then redirect to login page; if logged in, return the orginal view.\n\n\n\n### Step 6. Templates\n\nThough `auth.login` view has been created, a `TemplateNotFound` error will be raised when you visit http://127.0.0.1:5000/auth/login.\n\n\n\n![image-20221202154357379](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221202154357379.png)\n\nThis is because the view calls `render_template()`, but no templates are created. \n\n\n\nTips:\n\n* The template files will be stored in the `templates` directory inside the `flaskr` package.\n* Templates are files that contain static data as well as placeholders for dynamic data. \n* A template is rendered with specific data to produce a final document. Flask uses the [Jinja](https://jinja.palletsprojects.com/templates/) template library to render templates.\n* Special delimiters are used to distinguish Jinja syntax from the static data in the template. \n  * Anything between `{{` and `}}` is an expression that will be output to the final document. \n  * `{%` and `%}` denotes a control flow statement like `if` and `for`\n\n\n\n#### The Base Layout\n\nEach page in the app has the same basic layout around a different body.Instead of writing the entire HTML structure in each template, each template will extend a base template and override specific sections.\n\n\n\nFile: `flaskr/templates/base.html`\n\n```html\n\u003c!DOCTYPE html\u003e\n\u003ctitle\u003e{% block title %}{% endblock %} - Flaskr\u003c/title\u003e\n\u003clink rel=\"stylesheet\" href=\"{{ url_for('static', filename='style.css') }}\"\u003e\n\u003cnav\u003e\n   \u003ch1\u003eFlaskr\u003c/h1\u003e\n   \u003cul\u003e\n    {% if g.user %}\n        \u003cli\u003e\u003cspan\u003e{{ g.user['username'] }}\u003c/span\u003e\u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"{{ url_for('auth.logout') }}\"\u003eLog Out\u003c/a\u003e\u003c/li\u003e\n    {% else %}\n        \u003cli\u003e\u003ca href=\"{{ url_for('auth.register') }}\"\u003eRegister\u003c/a\u003e\u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"{{ url_for('auth.login') }}\"\u003eLog \u003cInput:c\u003e\u003c/Input:c\u003e\u003c/a\u003e\u003c/li\u003e\n    {% endif %}\n   \u003c/ul\u003e \n\u003c/nav\u003e\n\n\u003csection class=\"content\"\u003e\n    \u003cheader\u003e\n        {% block header %}\n        {% endblock %}\n    \u003c/header\u003e\n    {% for message in get_flashed_messages() %}\n        \u003cdiv class=\"flash\"\u003e{{ message }}\u003c/div\u003e\n    {% endfor %}\n    \n    {% block content %}\n    {% endblock %}\n\u003c/section\u003e\n\n```\n\n\n\n\u003eNotes: Using `Jinja Snippets` and `HTML CSS Support` extensions in vscode is helpful to write html code of Jinja templates.\n\n\n\nThere are three blocks defined here that will be overridden in the other templates:\n\n* `{% block title %}` will change the title displayed in the browserâ€™s tab and window title.\n* `{% block header %}` is similar to `title` but will change the title displayed on the page.\n* `{% block content %}` is where the content of each page goes, such as the login form or a blog post.\n\n\n\nThe base template is directly in the `templates` directory. To keep the others organized, the templates for a blueprint will be placed in a directory with the same name as the blueprint.\n\n#### Register template\n\nFile: `flaskr/templates/register.html`\n\n```html\n{% extends 'base.html' %}\n\n{% block header %}\n    \u003ch1\u003e{% block title %}Register{% endblock %}\u003c/h1\u003e\n{% endblock %}\n\n{% block content %}\n    \u003cform method=\"post\"\u003e\n        \u003clabel for=\"username\"\u003eUsername\u003c/label\u003e\n        \u003cinput name=\"username\" id=\"username\" required\u003e        \n        \u003clabel for=\"password\"\u003ePassword\u003c/label\u003e\n        \u003cinput type=\"password\" name=\"password\" id=\"password\" required\u003e\n        \u003cinput type=\"submit\" value=\"Register\"\u003e\n    \u003c/form\u003e\n{% endblock %}\n```\n\n\n#### Log In template\n\nThis is identical to the register template except for the title and submit button.\n\n```html\n{% extends 'base.html' %}\n\n{% block header %}\n    \u003ch1\u003e{% block title %}Log In{% endblock %}\u003c/h1\u003e\n{% endblock %}\n\n{% block content %}\n    \u003cform method=\"post\"\u003e\n        \u003clabel for=\"username\"\u003eUsername\u003c/label\u003e\n        \u003cinput name=\"username\" id=\"username\" required\u003e        \n        \u003clabel for=\"password\"\u003ePassword\u003c/label\u003e\n        \u003cinput type=\"password\" name=\"password\" id=\"password\" required\u003e\n        \u003cinput type=\"submit\" value=\"Log In\"\u003e\n    \u003c/form\u003e\n{% endblock %}\n```\n\n\n\n#### Register a user\n\nVisit http://127.0.0.1:5000/auth/register\n\n![image-20221202174125671](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221202174125671.png)\n\nIf no password inputed, you will see:\n\n![image-20221202174349791](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221202174349791.png)\n\nIf register succeeds, it will redirect to login page:\n\n![image-20221202174548748](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221202174548748.png)\n\nIf incorrect password is inputed, you will get `Incorrect password` warning:\n\n![image-20221202174721957](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221202174721957.png)\n\n\n\n### Step 7. Static Files\n\nUse css file in the `flask/static` directory to give the webpages some style. In the `base.html` template there is already a link to `style.css` file.\n\n```html\n{{ url_for('static', filename='style.css') }}\n```\n\n\n\nFile: flask/static/style.css\n\n```css\nhtml { font-family: sans-serif; background: #eee; padding: 1rem; }\nbody { max-width: 960px; margin: 0 auto; background: white; }\nh1 { font-family: serif; color: #377ba8; margin: 1rem 0; }\na { color: #377ba8; }\nhr { border: none; border-top: 1px solid lightgray; }\nnav { background: lightgray; display: flex; align-items: center; padding: 0 0.5rem; }\nnav h1 { flex: auto; margin: 0; }\nnav h1 a { text-decoration: none; padding: 0.25rem 0.5rem; }\nnav ul  { display: flex; list-style: none; margin: 0; padding: 0; }\nnav ul li a, nav ul li span, header .action { display: block; padding: 0.5rem; }\n.content { padding: 0 1rem 1rem; }\n.content \u003e header { border-bottom: 1px solid lightgray; display: flex; align-items: flex-end; }\n.content \u003e header h1 { flex: auto; margin: 1rem 0 0.25rem 0; }\n.flash { margin: 1em 0; padding: 1em; background: #cae6f6; border: 1px solid #377ba8; }\n.post \u003e header { display: flex; align-items: flex-end; font-size: 0.85em; }\n.post \u003e header \u003e div:first-of-type { flex: auto; }\n.post \u003e header h1 { font-size: 1.5em; margin-bottom: 0; }\n.post .about { color: slategray; font-style: italic; }\n.post .body { white-space: pre-line; }\n.content:last-child { margin-bottom: 0; }\n.content form { margin: 1em 0; display: flex; flex-direction: column; }\n.content label { font-weight: bold; margin-bottom: 0.5em; }\n.content input, .content textarea { margin-bottom: 1em; }\n.content textarea { min-height: 12em; resize: vertical; }\ninput.danger { color: #cc2f2e; }\ninput[type=submit] { align-self: start; min-width: 10em; }\n```\n\n\n\nAfter that, reload the login page, and you can see:\n\n![image-20221202175806462](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221202175806462.png)\n\n\n\n### Step 8. Blog Blueprint\n\nImplement the blog blueprint to allow a logged-in user to create posts and edit/delete the posts of his/her own.\n\n\u003e Note: As you implement each view, keep the development server running. As you save your changes, try going to the URL in your browser and testing them out.\n\n\n\n#### The Blog Blueprint\n\n\n\nDefine blog blueprint in file: `flask/blog.py`\n\n```Â \nfrom flask import (\n    Blueprint, flash, g, redirect, render_template, request, session, url_for\n)\nfrom werkzeug.exceptions import abort\n\nfrom flaskr.db import get_db\nfrom flaskr.auth import login_required\n\nbp = Blueprint('auth', __name__)\n```\n\n\n\nRegister this blueprint in the app factory in file : `flask/__init__.py`\n\n```python\ndef create_app(test_config=None):\n    # create and configure the app\n    app = ...\n    # existing code omitted\n\n    # add blog blueprint\n    from . import blog\n    app.register_blueprint(blog.bp)\n    app.add_url_rule('/', endpoint='index')\n\n    return app\n```\n\n\n\nUnlike the auth blueprint, the blog blueprint does not have a `url_prefix`. So the index view will be at `/`, the create view at `/create`. The blog is the main feature of Flaskr app, so it makes sense that the blog index will be the main index.\n\n\n\nThe endpoint for index view in blog blueprint will be `blog.index`. The `app.add_url_rule('/', endpoint='index')` code associates the endpoint name 'index' with the `/` url so that `url_for('index')` or `url_for('blog.index')` will both work, generating the same `/` URL either way. \n\n\n\n#### Index: view and template\n\nThe index view shows all the posts of the logged-in user, order by created time desc. Use SQL's JOIN clause.\n\n\n\nDefine index view in file: `flaskr/blog.py`:\n\n```python\n@bp.route('/')\ndef index():\n    db = get_db()\n    posts = db.execute(\n        'SELECT p.id, title, body, created, author_id, username'\n        ' FROM post p JOIN user u ON p.author_id = u.id'\n        ' ORDER BY created DESC'\n    ).fetchall()\n    return render_template('blog/index.html', posts=posts)\n```\n\n\n\nDefine index template in file: `flaskr/templates/index.html`:\n\n```html\n{% extends 'base.html' %}\n\n{% block header %}\n    \u003ch1\u003e{% block title %}Posts{% endblock %}\u003c/h1\u003e\n    {% if g.user %}\n        \u003ca class=\"action\" href=\"{{ url_for('blog.create') }}\" \u003eNew\u003c/a\u003e\n    {% endif %}\n{% endblock %}\n\n{% block content %}\n    {% for post in posts %}\n        \u003carticle class=\"post\"\u003e\n            \u003cheader\u003e\n                \u003cdiv\u003e\n                    \u003ch1\u003e{{ post['title'] }}\u003c/h1\u003e\n                    \u003cdiv class=\"about\"\u003eby {{ post['username'] }} on {{ post['created'].strftime('%Y-%m-%d') }}\u003c/div\u003e\n                \u003c/div\u003e\n                {% if g.user['id'] == post['author_id'] %}\n                    \u003ca class=\"action\" href=\"{{ url_for('blog.update', id=post['id']) }}\"\u003eEdit\u003c/a\u003e\n                {% endif %}\n            \u003c/header\u003e\n        \u003c/article\u003e\n        {% if not loop.last %}\n            \u003chr\u003e\n        {% endif %}\n    {% endfor %}\n{% endblock %}\n```\n\nTips:\n\n* when a user is logged in, the `header` block adds a link to the `create` view.\n* when the user is the author of a post, an `Edit` link to the `update` view will be seen.\n* `loop.last` is a special variable of Jinja's loop.\n\n\n\n#### Create: view and template\n\nThe `blog.create` view acts the similar way as `auth.register` view.\n\nDefine `blog.create` view in file: `flaskr/blog.py`:\n\n```python\n@bp.route('/create', methods=('GET', 'POST'))\n@login_required\ndef create():\n    if request.method == 'POST':\n        title = request.form['title']\n        body = request.form['body']\n        error = None\n\n        if not title:\n            error = 'Title is requested.'\n        \n        if error is not None:\n            flash(error)\n        else:\n            db = get_db()\n            db.execute(\n                'INSERT INTO post (title, body, author_id)'\n                ' VALUES (?, ?, ?)',\n                (title, body, g.user['id'])\n            )\n            db.commit()\n            return redirect(url_for('blog.index'))\n            \n    return render_template('blog/create.html')\n```\n\n\n\nTips:\n\n* if a new post is POSTed, add it into the database.\n* Or display the form of creating post in the `create` template.\n* Login_required decorator is used here to insure the user is logged-in before a new post is created.\n\n\n\nDefine the `create` template in file: `flaskr/templates/blog/create.html`\n\n```html\n{% extends 'base.html' %}\n\n{% block header %}\n    \u003ch1\u003e{% block title %}New Post{% endblock %}\u003c/h1\u003e\n{% endblock %}\n\n{% block content %}\n    \u003cform method=\"POST\"\u003e\n        \u003clabel for=\"title\"\u003eTitle\u003c/label\u003e\n        \u003cinput name=\"title\" id=\"title\" value=\"{{ request.form['title'] }}\" required\u003e\n        \u003clabel for=\"body\"\u003eBody\u003c/label\u003e\n        \u003ctextarea name=\"body\" id=\"body\"\u003e{{ request.form['body'] }}\u003c/textarea\u003e\n        \u003cinput type=\"submit\" value=\"Save\"\u003e\n    \u003c/form\u003e\n{% endblock %}\n```\n\n\n\n#### Update: view and template\n\nWrite a `get_post()` function to fetch a post by id and check if the author equals the logged in user. This function will be used in `update` and `delete` view.\n\n\n\nDefine get_post() function in file: `flaskr/blog.py`:\n\n```python\ndef get_post(id, check_author=True):\n    post = get_db().execute(\n        'SELECT p.id, title, body, created, author_id, user_name'\n        ' FROM post p JOIN user u ON p.author_id=u.id'\n        ' WHERE p.id = ?',\n        (id,)\n    ).fetchone()\n\n    if post is None:\n        abort(404, f'Post id {id} does not exist.')\n\n    if check_author and post['author_id'] != g.user['id']:\n        abort(403)\n    \n    return post\n```\n\nTips:\n\n* `abort()` will raise a exception that returns an HTTP status code like 404 (Not Found) or 403 (Forbidden).\n\n\n\nDefine `update` view in file: `flaskr/blog.py`:\n\n```python\n\n@bp.route('/\u003cint:id\u003e/update', methods=('GET', 'POST'))\n@login_required\ndef update(id):\n    post = get_post(id)\n\n    if request.method == 'POST':\n        title = request.form['title']\n        body = request.form['body']\n        error = None\n\n        if not title:\n            error = 'Title is required.'\n        \n        if error is not None:\n            flash(error)\n        else:\n            db = get_db()\n            db.execute(\n                'UPDATE post SET title = ?, body = ?'\n                ' WHERE id = ?',\n                (title, body, id)\n            )\n            db.commit()\n            return redirect(url_for('blog.index'))\n        \n    return render_template('blog/update.html', post=post)\n```\n\nTips:\n\n* `update` view takes an argument `id` , which corresponds to the `\u003cint:id\u003e` in the route. A real URL will look like `/1/update`. And the url_for() function also needs to be passed the `id` argument in the way of `url_for('blog.update', id=post['id'])`.\n\n\n\nDefine the update template in file: `flaskr/templates/blog/update.html`\n\n```html\n{% extends 'base.html' %}\n\n{% block header %}\n    \u003ch1\u003e{% block title %}Edit \"{{ post['title'] }}\"{% endblock %}\u003c/h1\u003e\n{% endblock %}\n\n{% block content %}\n    \u003cform method=\"POST\"\u003e\n        \u003clabel for=\"title\"\u003eTitle\u003c/label\u003e\n        \u003cinput name=\"title\" id=\"title\" value=\"{{ request.form['title'] or post['title'] }}\" required\u003e\n        \u003clabel for=\"body\"\u003eBody\u003c/label\u003e\n        \u003ctextarea name=\"body\" id=\"body\"\u003e{{ request.form['body'] or post['body'] }}\u003c/textarea\u003e\n        \u003cinput type=\"submit\" value=\"Save\"\u003e\n    \u003c/form\u003e\n    \u003chr\u003e\n    \u003cform action=\"{{ url_for('blog.delete', id=post['id']) }}\" method=\"post\"\u003e\n        \u003cinput type=\"submit\" value=\"Delete\" class=\"danger\" onclick=\"return confirm('Are you sure?');\"\u003e\n    \u003c/form\u003e\n{% endblock %}\n```\n\n\n\nTips:\n\n* This templates has two forms:\n  * The first one to edit the current post(`/\u003cid\u003e/update`)\n  * The other one to delete the post\n* The pattern `{{ request.form['title'] or post['title'] }}` is used to choose what data appears in the form. \n  * When the form hasnâ€™t been submitted, the original `post` data appears\n  * but if invalid form data was posted you want to display that so the user can fix the error, so `request.form` is used instead.\n\n\n\n#### Delete: view\n\nThe delete view has no template. Define it:\n\n```python\n@bp.route('/\u003cint:id\u003e/delete', methods=('POST',))\n@login_required\ndef delete(id):\n    get_post(id)\n    db = get_db()\n    db.execute('DELETE FROM post WHERE id = ?', (id,))\n    db.commit()\n    return redirect(url_for('blog.index'))\n\n```\n\n\n\nNow all code are finished. Try it!\n\n\n\nlog in \n\n![image-20221203225939183](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221203225939183.png)\n\n\n\nLog out\n\n![image-20221203230028831](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221203230028831.png)\n\n\n\nCreate a post\n\n![image-20221203230103978](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221203230103978.png)\n\n\n\nWriting\n\n![image-20221203230232647](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221203230232647.png)\n\n\n\nsaved\n\n![image-20221203230339421](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221203230339421.png)\n\nedit\n\n![image-20221203230548770](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221203230548770.png)\n\n\n\nGreat!\n","lastmodified":"2022-12-14T10:05:00.50340721Z","tags":null},"/notes/hands-on-zeppelin":{"title":"Hands on Zeppelin","content":"\n\n\n# Hands on Zeppelin: Step by Step\n\n\u003e In order to build a data playground enabling the engineers to explore data collected by autonomous cars, I am trying to deploy Apache Zeppelin as a component of data platform.\n\n## Introduction\n\n[Apache Zeppelin](https://zeppelin.apache.org/) is: \"Web-based notebook that enables data-driven,\ninteractive data analytics and collaborative documents with SQL, Scala, Python, R and more.\"\n\n\n\n## Install\n\nAccording to [installation document](https://zeppelin.apache.org/docs/0.10.0/quickstart/install.html), I choose to install Zeppelin using the offical docker on a server (http://10.10.32.4):\n\n```sh\n$ mkdir Zeppelin \u0026 cd Zeppelin\n$ docker run -u $(id -u) -p 8080:8080 --rm -v $PWD/logs:/logs -v $PWD/notebook:/notebook \\\n           -e ZEPPELIN_LOG_DIR='/logs' -e ZEPPELIN_NOTEBOOK_DIR='/notebook' \\\n           --name zeppelin apache/zeppelin:0.10.0\n\nUnable to find image 'apache/zeppelin:0.10.0' locally\n0.10.0: Pulling from apache/zeppelin\n16ec32c2132b: Pull complete\naafd5bdc2bb7: Pull complete\n0bb58b150809: Pull complete\n68d71ea3a296: Pull complete\n9c7277321f0c: Downloading [=============================================\u003e     ]   2.59GB/2.816GB\n6be3e4488900: Download complete\n622d30c2f649: Download complete\nd10a38bf471f: Download complete\n4006c4346d45: Download complete\n4f4fb700ef54: Download complete\n\n...\n\nERROR [2022-12-13 08:13:15,873] ({main} ZeppelinServer.java[main]:262) - Error while running jettyServer\njava.lang.Exception: A MultiException has 2 exceptions.  They are:\n1. java.io.IOException: Creating directories for /notebook/.git failed\n2. java.lang.IllegalStateException: Unable to perform operation: create on org.apache.zeppelin.notebook.repo.NotebookRepoSync\n\n\tat org.apache.zeppelin.server.ZeppelinServer.main(ZeppelinServer.java:256)\n\n```\n\n\n\nThese two error was raised because of [Volume mapping issue with Zeppelin](https://forums.docker.com/t/volume-mapping-issue-with-zeppelin/121917), you can fix it to add\n\n`-u 0` parameter to set the user to 0 (root) in docker run.\n\n```sh\n$ docker run -u $(id -u) -p 8080:8080 -u 0 --rm -v $PWD/logs:/logs -v $PWD/notebook:/notebook \\\n           -e ZEPPELIN_LOG_DIR='/logs' -e ZEPPELIN_NOTEBOOK_DIR='/notebook' \\\n           --name zeppelin apache/zeppelin:0.10.0\n```\n\n\n\nor you can change the owner of dir `logs` and `notebook` using:\n\n```sh\n$ sudo chown -R 1000:1000 notebook\n$ sudo chown -R 1000:1000 logs\n$ docker run -u $(id -u) -p 8080:8080 --rm -v $PWD/logs:/logs -v $PWD/notebook:/notebook \\\n           -e ZEPPELIN_LOG_DIR='/logs' -e ZEPPELIN_NOTEBOOK_DIR='/notebook' \\\n           --name zeppelin apache/zeppelin:0.10.0\n```\n\n\n\nThen visit http://10.10.32.4:8080/ to use Zeppelin.\n\n![image-20221213165658796](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221213165658796.png)\n\n\n\n## Create New Note\n\n![yshJJIkNnq](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/yshJJIkNnq.jpg)\n\nCreate a new note through these two entries by giving it a name and select a default interpreter.\n\n\u003cimg src=\"https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221214150836370.png\" alt=\"image-20221214150836370\" style=\"zoom:50%;\" /\u003e\n\n\u003e You can use multiple interpreter in one zeppeline note to support different languages. You can get this via ChatGPT. See details in \"Q\u0026A (with ChatGPT on Zeppelin)\" part.\n\n![image-20221214151356720](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221214151356720.png)\n\nI write 3 different code snippet in 3 different languages of Markdown, Python and sql. Run them and we will get:\n\n![image-20221214151758144](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221214151758144.png)\n\nYou can see: \n\n* %md and %python work fine.\n* %sql gives an error: Interpreter sql not found.\n\n## Interpreters\n\nWe can see and manage Zeppelin's interpreters via the 'interpreter' menu below: \n\n\u003cimg src=\"https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221214151959692.png\" alt=\"image-20221214151959692\" style=\"zoom:50%;\" /\u003e\n\n\n\nAll interpreters are here:\n\n![image-20221214154255076](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221214154255076.png)\n\n## Add a SQL interpreter\n\nIn order to access data in mysql, add a SQL interpreter:\n\nReference: \n\n* [SQL support in Zeppelin](https://zeppelin.apache.org/docs/0.8.0/quickstart/sql_with_zeppelin.html)\n* [Generic JDBC Interpreter for Apache Zeppelin - mysql](https://zeppelin.apache.org/docs/0.8.0/interpreter/jdbc.html#mysql)\n\n\u003e If you want to connect other databases such as `Mysql`, `Redshift` and `Hive`, you need to edit the property values. You can also use [Credential](https://zeppelin.apache.org/docs/latest/setup/security/datasource_authorization.html) for JDBC authentication. If `default.user` and `default.password` properties are deleted(using X button) for database connection in the interpreter setting page, the JDBC interpreter will get the account information from [Credential](https://zeppelin.apache.org/docs/latest/setup/security/datasource_authorization.html).\n\n* [Data Source Authorization in Apache Zeppelin](https://zeppelin.apache.org/docs/0.7.0/security/datasource_authorization.html)\n* [Tutorial: Using Apache Zeppelin with MySQL](https://thedataist.com/tutorial-using-apache-zeppelin-with-mysql/)\n\n\n\nFirst, add a credential info, which stores safely the username and password of the mysql connection:\n\n![image-20221214164153294](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221214164153294.png)\n\n\n\nSecond, add a new interpreter `adbsql` as \n\n![image-20221214164336089](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221214164336089.png)\n\nRemember to add dependencies to locate the jar used to run the mysql driver:\n\n![image-20221214164508044](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221214164508044.png)\n\n\n\n## Access Data using SQL\n\nThen I can access the data in mysql using sql like this:\n\n![image-20221214171612554](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221214171612554.png)\n\n## Q\u0026A (with ChatGPT on Zeppelin)\n\n### Can I use python and sql in one zeppelin note?\n\nChatGPT:\n\n\u003e Yes, it is possible to use Python and SQL together in a Zeppelin notebook. In fact, many data analysis tasks can benefit from combining the capabilities of both languages.\n\u003e\n\u003e \n\u003e\n\u003e To use Python and SQL together in a Zeppelin notebook, you will first need to make sure that you have the appropriate interpreters installed and configured. In Zeppelin, an interpreter is a plug-in that enables the notebook to execute code in a specific programming language. For Python and SQL, you will need to install and configure the Python and SQL interpreters, respectively.\n\u003e\n\u003e \n\u003e\n\u003e Once the interpreters are installed and configured, you can use the `%python` and `%sql` magic commands in your Zeppelin notebook to switch between Python and SQL code blocks. For example, you could use Python to load and clean your data, and then use SQL to analyze and visualize the cleaned data.\n\u003e\n\u003e Here is an example of how you might use Python and SQL together in a Zeppelin notebook:\n\n```python\n%python\n# load and clean data using Python\n\nimport pandas as pd\n\ndf = pd.read_csv(\"data.csv\")\ndf = df.dropna()\n\n%sql\n-- analyze and visualize data using SQL\n\nSELECT * FROM df LIMIT 10\n\n```\n\n\u003e I hope this helps! Let me know if you have any other questions.\n\n\n\n### SQL: how to add a sql interpreter to apache zeppelin\n\n\u003cimg src=\"https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221214155408956.png\" alt=\"image-20221214155408956\" style=\"zoom:50%;\" /\u003e\n\n### Java: hello world in apache zeppelin\n\n[Java interpreter for Apache Zeppelin](https://zeppelin.apache.org/docs/0.9.0/interpreter/java.html)\n\nChatGPT:\n\n![image-20221214152806322](https://happy3-data.oss-cn-hangzhou.aliyuncs.com/content-images/image-20221214152806322.png)\n","lastmodified":"2022-12-14T10:05:00.50340721Z","tags":null},"/notes/python-programming":{"title":"Python Programming","content":"\n# Python Programming\n\n## Flask\n\n* [Hands on Flask](notes/hands-on-flask.md)\n","lastmodified":"2022-12-14T10:05:00.50340721Z","tags":null}}